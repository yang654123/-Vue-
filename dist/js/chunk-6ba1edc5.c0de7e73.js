(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6ba1edc5"],{"1b80":function(t,e,o){"use strict";e["a"]={data:function(){return{pagination:{page:1,pageSize:10,total:0,showTotal:function(t,e){return"共 ".concat(t," 条")}}}},computed:{requestData:function(){return{page:this.pagination.page,pageSize:this.pagination.pageSize}}},methods:{init:function(){},pageChange:function(t){this.pagination.page=t,this.requestData.page=t.current,this.init()}}}},2328:function(t,e,o){},"386b":function(t,e,o){var a=o("5ca1"),r=o("79e5"),n=o("be13"),s=/"/g,i=function(t,e,o,a){var r=String(n(t)),i="<"+e;return""!==o&&(i+=" "+o+'="'+String(a).replace(s,"&quot;")+'"'),i+">"+r+"</"+e+">"};t.exports=function(t,e){var o={};o[t]=e(i),a(a.P+a.F*r((function(){var e=""[t]('"');return e!==e.toLowerCase()||e.split('"').length>3})),"String",o)}},"3ed7":function(t,e,o){"use strict";var a=o("2328"),r=o.n(a);r.a},"58bf":function(t,e,o){"use strict";o.r(e);var a=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("a-tabs",{attrs:{tabPosition:"left",defaultActiveKey:"1",animated:!1},model:{value:t.tabKey,callback:function(e){t.tabKey=e},expression:"tabKey"}},[o("a-tab-pane",{key:"1"},[o("span",{attrs:{slot:"tab"},slot:"tab"},[o("a-icon",{attrs:{type:"heat-map"}}),t._v("概览 ")],1),o("div",{staticClass:"config-content"},[o("div",{staticClass:"content-item"},[o("div",{staticClass:"infos"},[o("p",{staticClass:"item-title"},[t._v("项目封面")]),o("div",{staticClass:"cover-item"},[t.project.cover?[o("img",{staticClass:"avatar",attrs:{src:t.project.cover}})]:t._e(),o("span",{directives:[{name:"show",rawName:"v-show",value:!t.project.cover,expression:"!project.cover"}],staticClass:"no-avatar"}),o("a-upload",{staticClass:"cover-uploader",attrs:{name:"cover",showUploadList:!1,headers:t.headers,action:t.uploadAction,beforeUpload:t.beforeUpload},on:{change:t.handleChange}},[o("a-button",{staticClass:"upload",attrs:{size:"large"}},[t._v("上传新封面")]),o("p",{staticClass:"upload-tips muted"},[t._v("最佳图片比例为300*150")])],1)],2)])]),o("div",{staticClass:"content-item"},[o("div",{staticClass:"infos"},[o("p",{staticClass:"item-title"},[t._v("项目名称")]),o("a-input",{attrs:{size:"large"},model:{value:t.project.name,callback:function(e){t.$set(t.project,"name",e)},expression:"project.name"}})],1),o("div",{staticClass:"infos"},[o("p",{staticClass:"item-title"},[t._v("项目进度 (%)")]),o("a-input-number",{attrs:{size:"large",min:0,max:100},model:{value:t.project.schedule,callback:function(e){t.$set(t.project,"schedule",e)},expression:"project.schedule"}})],1)]),o("div",{staticClass:"content-item"},[o("div",{staticClass:"infos"},[o("p",{staticClass:"item-title"},[t._v("项目简介")]),o("a-input",{attrs:{type:"textarea",rows:3,size:"large",placeholder:"介绍一下这个项目"},model:{value:t.project.description,callback:function(e){t.$set(t.project,"description",e)},expression:"project.description"}})],1)]),o("div",{staticClass:"content-item"},[o("div",{staticClass:"infos"},[o("p",{staticClass:"item-title"},[t._v("项目公开性")]),o("a-select",{attrs:{size:"large"},model:{value:t.project.private,callback:function(e){t.$set(t.project,"private",e)},expression:"project.private"}},[o("a-select-option",{key:0},[t._v("公开项目（所有人都可通过链接访问，仅项目成员可编辑）")]),o("a-select-option",{key:1},[t._v("私有项目（仅项目成员可查看和编辑）")])],1)],1)]),o("div",{staticClass:"content-item"},[o("div",{staticClass:"infos"},[o("p",{staticClass:"item-title"},[t._v("项目拥有者")]),o("div",{staticClass:"m-t"},[o("a-avatar",{attrs:{src:t.project.owner_avatar}}),o("span",{staticClass:"m-l"},[t._v(t._s(t.project.owner_name))])],1)])]),o("a-divider"),o("div",{staticClass:"content-item"},[o("div",{staticClass:"infos"},[o("a-button",{staticClass:"middle-btn pull-right",attrs:{type:"primary",size:"large"},on:{click:t.saveProject}},[t._v("保存")])],1)])],1)]),o("a-tab-pane",{key:"2",attrs:{forceRender:""}},[o("span",{attrs:{slot:"tab"},slot:"tab"},[o("a-icon",{attrs:{type:"eye"}}),t._v("项目偏好 ")],1),o("div",{staticClass:"config-content task-config"},[o("div",{staticClass:"content-item"},[o("div",{staticClass:"infos"},[o("p",{staticClass:"item-title"},[t._v("看板风格")]),o("div",{staticClass:"item-tips muted"},[t._v("\n            切换任务看板的主题风格，内置两种风格。\n          ")]),o("a-radio-group",{on:{change:t.saveProject},model:{value:t.project.task_board_theme,callback:function(e){t.$set(t.project,"task_board_theme",e)},expression:"project.task_board_theme"}},[o("a-radio",{staticStyle:{display:"block",height:"30px","line-height":"30px"},attrs:{value:"default"}},[t._v("默认")]),o("a-radio",{staticStyle:{display:"block",height:"30px","line-height":"30px"},attrs:{value:"simple"}},[t._v("简约")])],1)],1)]),o("div",{staticClass:"content-item"},[o("div",{staticClass:"infos"},[o("p",{staticClass:"item-title"},[t._v("自动更新项目进度")]),o("div",{staticClass:"item-tips muted"},[t._v("\n            根据当前任务的完成情况自动计算项目进度。\n          ")])]),o("a-switch",{on:{change:t.saveProject},model:{value:t.project.auto_update_schedule,callback:function(e){t.$set(t.project,"auto_update_schedule",e)},expression:"project.auto_update_schedule"}})],1)])]),o("a-tab-pane",{key:"3"},[o("span",{attrs:{slot:"tab"},slot:"tab"},[o("a-icon",{attrs:{type:"check-square"}}),t._v("任务设置 ")],1),o("div",{staticClass:"config-content task-config"},[o("div",{staticClass:"content-item"},[o("div",{staticClass:"infos"},[o("p",{staticClass:"item-title"},[t._v("项目ID")]),o("div",{staticClass:"item-tips muted"},[t._v("\n            设置项目编号，编号将作为 ID 前缀，用以区别项目。支持 2-6 位字母。\n          ")]),o("a-input",{staticClass:"prefix-input",attrs:{size:"large",placeholder:"如 Pear Project 可以设置为 EP",disabled:!t.project.open_prefix},model:{value:t.project.prefix,callback:function(e){t.$set(t.project,"prefix",e)},expression:"project.prefix"}}),o("a-button",{staticClass:"middle-btn",attrs:{size:"large",type:"primary",disabled:!t.project.open_prefix},on:{click:t.saveProject}},[t._v("保存")])],1),o("a-switch",{on:{change:t.saveProject},model:{value:t.project.open_prefix,callback:function(e){t.$set(t.project,"open_prefix",e)},expression:"project.open_prefix"}})],1),o("div",{staticClass:"content-item"},[o("div",{staticClass:"infos"},[o("p",{staticClass:"item-title"},[t._v("任务开始时间")]),o("div",{staticClass:"item-tips muted"},[t._v("\n            为任务设置开始时间，更科学地规划工作。\n          ")])]),o("a-switch",{on:{change:t.saveProject},model:{value:t.project.open_begin_time,callback:function(e){t.$set(t.project,"open_begin_time",e)},expression:"project.open_begin_time"}})],1),o("div",{staticClass:"content-item"},[o("div",{staticClass:"infos"},[o("p",{staticClass:"item-title"},[t._v("新任务默认开启隐私模式")]),o("div",{staticClass:"item-tips muted"},[t._v("\n            对本项目内的新任务默认开启隐私模式，创建成功后仅参与者可见\n          ")])]),o("a-switch",{on:{change:t.saveProject},model:{value:t.project.open_task_private,callback:function(e){t.$set(t.project,"open_task_private",e)},expression:"project.open_task_private"}})],1)])]),o("a-tab-pane",{key:"4",attrs:{forceRender:""}},[o("span",{attrs:{slot:"tab"},slot:"tab"},[o("a-icon",{attrs:{type:"deployment-unit"}}),t._v("任务流转 ")],1),o("div",{staticClass:"config-content"},[o("div",{staticClass:"content-item task-workflow"},[o("div",{staticClass:"infos",staticStyle:{"padding-right":"0"}},[o("div",{directives:[{name:"show",rawName:"v-show",value:!t.doTaskWorkflowView,expression:"!doTaskWorkflowView"}]},[o("p",[o("a-button",{attrs:{type:"primary",icon:"plus"},on:{click:function(e){return t.doTaskWorkflow(null)}}},[t._v("创建规则")])],1),o("a-list",{staticClass:"task-workflow-list",attrs:{itemLayout:"horizontal",dataSource:t.taskWorkflowList},scopedSlots:t._u([{key:"renderItem",fn:function(e){return o("a-list-item",{},[o("span",{attrs:{slot:"actions"},slot:"actions"},[o("a-tooltip",{attrs:{placement:"top",title:"编辑"}},[o("a",{staticClass:"muted m-r-sm",on:{click:function(o){return t.doTaskWorkflow(e)}}},[o("a-icon",{attrs:{type:"edit"}})],1)]),o("a-tooltip",{attrs:{placement:"top",title:"删除"}},[o("a",{staticClass:"muted",on:{click:function(o){return t.delTaskWorkflow(e.code)}}},[o("a-icon",{attrs:{type:"delete"}})],1)])],1),o("a-list-item-meta",[o("span",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.name))])])],1)}}])})],1),o("div",{directives:[{name:"show",rawName:"v-show",value:t.doTaskWorkflowView,expression:"doTaskWorkflowView"}]},[o("div",{staticClass:"header"},[o("p",[o("a-button",{staticClass:"middle-btn m-r-sm",attrs:{size:"large"},on:{click:function(e){return t.saveTaskWorkflow(!1)}}},[t._v("取消")]),o("a-button",{staticClass:"middle-btn",attrs:{size:"large",type:"primary",disabled:!t.canSaveTaskWorkflow},on:{click:function(e){return t.saveTaskWorkflow(!0)}}},[t._v("保存")])],1)]),o("div",{staticClass:"workflow-content"},[t.loadingWorkflowRule?t._e():[o("div",{staticClass:"workflow-rule-item"},[o("p",[t._v("规则名称")]),o("a-input",{attrs:{size:"large"},model:{value:t.currentTaskWorkflowRule.taskWorkflowName,callback:function(e){t.$set(t.currentTaskWorkflowRule,"taskWorkflowName",e)},expression:"currentTaskWorkflowRule.taskWorkflowName"}})],1),o("div",{staticClass:"workflow-rule-item"},[o("p",[t._v("选择任务列表")]),o("a-select",{attrs:{size:"large"},on:{change:function(e){return t.workflowRuleChange(e,"firstObj")}},model:{value:t.currentTaskWorkflowRule.firstObj,callback:function(e){t.$set(t.currentTaskWorkflowRule,"firstObj",e)},expression:"currentTaskWorkflowRule.firstObj"}},t._l(t.taskStages,(function(e,a){return o("a-select-option",{key:e.code,attrs:{value:e.code}},[t._v(t._s(e.name))])})),1)],1),t.currentTaskWorkflowRule.firstObj?[o("div",{staticClass:"workflow-rule-item"},[o("p",[t._v("选择条件")]),o("a-select",{attrs:{size:"large"},on:{change:function(e){return t.workflowRuleChange(e,"firstAction.action")}},model:{value:t.currentTaskWorkflowRule.firstAction.action,callback:function(e){t.$set(t.currentTaskWorkflowRule.firstAction,"action",e)},expression:"currentTaskWorkflowRule.firstAction.action"}},t._l(t.taskWorkflowRuleActions,(function(e,a){return o("a-select-option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.name))])})),1)],1),-1!=t.currentTaskWorkflowRule.firstAction.action?[3==t.currentTaskWorkflowRule.firstAction.action?[o("div",{staticClass:"workflow-rule-item"},[o("p",[t._v("选择执行者")]),o("a-select",{attrs:{size:"large"},on:{change:function(e){return t.workflowRuleChange(e,"firstAction.value")}},model:{value:t.currentTaskWorkflowRule.firstAction.value,callback:function(e){t.$set(t.currentTaskWorkflowRule.firstAction,"value",e)},expression:"currentTaskWorkflowRule.firstAction.value"}},t._l(t.projectMembers,(function(e,a){return o("a-select-option",{key:e.code,attrs:{value:e.code}},[t._v(t._s(e.name))])})),1)],1)]:t._e(),o("div",{staticClass:"workflow-rule-item"},[o("p",[t._v("选择结果")]),o("a-select",{attrs:{size:"large"},on:{change:function(e){return t.workflowRuleChange(e,"firstResult.action")}},model:{value:t.currentTaskWorkflowRule.firstResult.action,callback:function(e){t.$set(t.currentTaskWorkflowRule.firstResult,"action",e)},expression:"currentTaskWorkflowRule.firstResult.action"}},t._l(t.taskWorkflowRuleTypes,(function(e,a){return o("a-select-option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.name))])})),1)],1),0===t.currentTaskWorkflowRule.firstResult.action?[o("div",{staticClass:"workflow-rule-item"},[o("p",[t._v("流转任务列表")]),o("a-select",{attrs:{size:"large"},on:{change:function(e){return t.workflowRuleChange(e,"firstResult.value")}},model:{value:t.currentTaskWorkflowRule.firstResult.value,callback:function(e){t.$set(t.currentTaskWorkflowRule.firstResult,"value",e)},expression:"currentTaskWorkflowRule.firstResult.value"}},t._l(t.taskStages,(function(e,a){return o("a-select-option",{key:e.code,attrs:{value:e.code}},[t._v(t._s(e.name))])})),1)],1),t.currentTaskWorkflowRule.firstResult.value?[o("div",{staticClass:"workflow-rule-item"},[o("p",[t._v("选择执行者")]),o("a-select",{attrs:{size:"large"},on:{change:function(e){return t.workflowRuleChange(e,"lastResult.value")}},model:{value:t.currentTaskWorkflowRule.lastResult.value,callback:function(e){t.$set(t.currentTaskWorkflowRule.lastResult,"value",e)},expression:"currentTaskWorkflowRule.lastResult.value"}},t._l(t.projectMembers,(function(e,a){return o("a-select-option",{key:e.code,attrs:{value:e.code}},[t._v(t._s(e.name))])})),1)],1)]:t._e(),[o("div",{staticClass:"workflow-rule-item"},[o("p",[t._v("修改任务状态")]),o("a-select",{attrs:{size:"large"},on:{change:function(e){return t.workflowRuleChange(e,"state.value")}},model:{value:t.currentTaskWorkflowRule.state.value,callback:function(e){t.$set(t.currentTaskWorkflowRule.state,"value",e)},expression:"currentTaskWorkflowRule.state.value"}},t._l(t.taskStates,(function(e,a){return o("a-select-option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.name))])})),1)],1)]]:t._e(),3===t.currentTaskWorkflowRule.firstResult.action?[o("div",{staticClass:"workflow-rule-item"},[o("p",[t._v("选择执行者")]),o("a-select",{attrs:{size:"large"},on:{change:function(e){return t.workflowRuleChange(e,"firstAction.action")}},model:{value:t.currentTaskWorkflowRule.firstResult.value,callback:function(e){t.$set(t.currentTaskWorkflowRule.firstResult,"value",e)},expression:"currentTaskWorkflowRule.firstResult.value"}},t._l(t.projectMembers,(function(e,a){return o("a-select-option",{key:e.code,attrs:{value:e.code}},[t._v(t._s(e.name))])})),1)],1),t.currentTaskWorkflowRule.firstResult.value?[o("div",{staticClass:"workflow-rule-item"},[o("p",[t._v("流转任务列表")]),o("a-select",{attrs:{size:"large"},on:{change:function(e){return t.workflowRuleChange(e,"lastResult.value")}},model:{value:t.currentTaskWorkflowRule.lastResult.value,callback:function(e){t.$set(t.currentTaskWorkflowRule.lastResult,"value",e)},expression:"currentTaskWorkflowRule.lastResult.value"}},t._l(t.taskStages,(function(e,a){return o("a-select-option",{key:e.code,attrs:{value:e.code}},[t._v(t._s(e.name))])})),1)],1)]:t._e(),[o("div",{staticClass:"workflow-rule-item"},[o("p",[t._v("修改任务状态")]),o("a-select",{attrs:{size:"large"},on:{change:function(e){return t.workflowRuleChange(e,"state.value")}},model:{value:t.currentTaskWorkflowRule.state.value,callback:function(e){t.$set(t.currentTaskWorkflowRule.state,"value",e)},expression:"currentTaskWorkflowRule.state.value"}},t._l(t.taskStates,(function(e,a){return o("a-select-option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.name))])})),1)],1)]]:t._e()]:t._e()]:t._e()],o("div",{staticClass:"text-center"},[o("a-spin",{attrs:{spinning:t.loadingWorkflowRule}})],1)],2)])])])])]),o("a-tab-pane",{key:"5"},[o("span",{attrs:{slot:"tab"},slot:"tab"},[o("a-icon",{attrs:{type:"ellipsis"}}),t._v("更多 ")],1),o("div",{staticClass:"config-content more-config"},[o("div",{staticClass:"content-item"},[o("div",{staticClass:"infos"},[o("p",{staticClass:"item-title"},[t._v("项目操作")]),o("div",{staticClass:"item-tips muted"},[t._v("您可以执行以下操作")]),o("a-button",{staticClass:"middle-btn",attrs:{size:"large"},on:{click:t.archiveProject}},[t.project.archive?o("span",[t._v("取消归档")]):t._e(),t.project.archive?t._e():o("span",[t._v("归档项目")])]),o("a-button",{staticClass:"middle-btn",attrs:{size:"large"},on:{click:t.quitProject}},[t._v("退出")]),o("a-button",{staticClass:"middle-btn",attrs:{size:"large",type:"danger"},on:{click:t.delProject}},[t.project.deleted?o("span",[t._v("恢复项目")]):t._e(),t.project.deleted?t._e():o("span",[t._v("移至回收站")])])],1)])])])],1)},r=[],n=(o("ac6a"),o("a481"),o("c5f6"),o("7f7f"),o("6be7")),s=o("22b6");function i(t){return s["a"].post("project/task_workflow",t)}function c(t){return s["a"].post("project/task_workflow/_getTaskWorkflowRules",t)}function l(t){return s["a"].post("project/task_workflow/save",t)}function u(t){return s["a"].post("project/task_workflow/edit",t)}function f(t){return s["a"].post("project/task_workflow/delete",t)}var p=o("9f09"),d=o("c030"),k=o("97a8"),v=o("2f14"),m={name:"projectConfig",props:{code:{type:[String],default:function(){return""}}},data:function(){return{loading:!1,tabKey:"1",project:{},taskWorkflowList:[],doTaskWorkflowView:!1,loadingWorkflowRule:!1,taskWorkflow:null,taskWorkflowRuleList:[],currentTaskWorkflowRule:{taskWorkflowName:"",firstObj:"",firstAction:{action:-1,value:""},firstResult:{action:-1,value:""},lastResult:{action:-1,value:""},state:{action:-1,value:-1}},taskWorkflowRuleActions:[{id:-1,name:"请选择"},{id:0,name:"增加任务、被移动"},{id:1,name:"被完成"},{id:2,name:"被重做"},{id:3,name:"设置执行人"}],taskWorkflowRuleTypes:[{id:-1,name:"请选择"},{id:0,name:"自动流转到"},{id:3,name:"默认指派给"}],taskStates:[{id:-1,name:"不做修改"},{id:1,name:"已完成"},{id:2,name:"未完成"}],projectMembers:[],taskStages:[],uploadLoading:!1,uploadAction:Object(v["c"])("project/project/uploadCover")}},computed:{headers:function(){return Object(v["d"])()},canSaveTaskWorkflow:function(){return this.currentTaskWorkflowRule.taskWorkflowName.trim()&&this.currentTaskWorkflowRule.firstObj&&-1!=this.currentTaskWorkflowRule.firstAction.action&&-1!=this.currentTaskWorkflowRule.firstResult.action&&this.currentTaskWorkflowRule.firstResult.value}},watch:{code:function(){this.getProject()}},created:function(){this.getProject(),this.getTaskWorkflowList()},methods:{getProject:function(){var t=this;this.loading=!0,Object(n["h"])(this.code).then((function(e){t.loading=!1,t.project=e.data,t.project.open_prefix=!!e.data.open_prefix,t.project.open_begin_time=!!e.data.open_begin_time,t.project.open_task_private=!!e.data.open_task_private,t.project.auto_update_schedule=!!e.data.auto_update_schedule}))},getTaskWorkflowList:function(){var t=this;i({projectCode:this.code}).then((function(e){t.taskWorkflowList=e.data}))},saveProject:function(){var t=this,e=this.project;Object(n["e"])({projectCode:e.code,name:e.name,description:e.description,cover:e.cover,private:e.private,prefix:e.prefix,task_board_theme:e.task_board_theme,open_prefix:Number(e.open_prefix),open_begin_time:Number(e.open_begin_time),open_task_private:Number(e.open_task_private),schedule:Number(e.schedule),auto_update_schedule:Number(e.auto_update_schedule)}).then((function(e){Object(v["a"])(e)&&(t.$emit("update",t.project),Object(k["b"])({title:"保存成功"},"notice","success"))}))},archiveProject:function(){var t=this;t.project.archive?this.$confirm({title:"取消归档项目？",content:"取消归档「".concat(this.project.name,"」后就可以正常使用了"),okText:"取消归档",okType:"primary",cancelText:"再想想",onOk:function(){return Object(n["j"])(t.code).then((function(e){Object(v["a"])(e)&&t.$router.replace("/project/list/my")})),Promise.resolve()}}):this.$confirm({title:"归档项目",content:"一旦将项目「".concat(this.project.name,"」归档，本项目和所含信息将会被移到「归档项目」内，其中的内容依然会被统计和搜索收录，归档项目可以随时恢复并继续使用。"),okText:"归档",okType:"danger",cancelText:"再想想",onOk:function(){return Object(n["d"])(t.code).then((function(e){Object(v["a"])(e)&&t.$router.replace("/project/archive")})),Promise.resolve()}})},delProject:function(){var t=this;t.project.deleted?this.$confirm({title:"确定恢复项目？",content:"恢复「".concat(this.project.name,"」后就可以正常使用了"),okText:"恢复项目",okType:"primary",cancelText:"再想想",onOk:function(){return Object(n["i"])(t.code).then((function(e){Object(v["a"])(e)&&t.$router.replace("/project/list/my")})),Promise.resolve()}}):this.$confirm({title:"确定放入回收站？",content:"一旦将项目「".concat(this.project.name,"」放入回收站，所有与项目有关的信息将会被放入回收站"),okText:"放入回收站",okType:"danger",cancelText:"再想想",onOk:function(){return Object(n["k"])(t.code).then((function(e){Object(v["a"])(e)&&t.$router.replace("/project/recycle")})),Promise.resolve()}})},quitProject:function(){var t=this;this.$confirm({title:"退出项目",content:"一旦你退出了该项目，你将不能查看任何关于该项目的信息。退出项目后，如果想重新加入，请联系项目管理员。",okText:"确定退出",okType:"primary",cancelText:"再想想",onOk:function(){return Object(n["g"])(t.code).then((function(e){Object(v["a"])(e)&&t.$router.replace("/project/list/my")})),Promise.resolve()}})},doTaskWorkflow:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.getTaskStages(),this.getProjectMembers(),this.taskWorkflow=t,t?(this.loadingWorkflowRule=!0,this.currentTaskWorkflowRule.taskWorkflowName=t.name,this.getTaskWorkflowRules(t.code)):this.currentTaskWorkflowRule={taskWorkflowName:"",firstObj:"",firstAction:{action:-1,value:""},firstResult:{action:-1,value:""},lastResult:{action:-1,value:""},state:{action:-1,value:-1},taskStates:[{id:-1,name:"不做修改"},{id:1,name:"已完成"},{id:2,name:"未完成"}]},this.doTaskWorkflowView=!0},saveTaskWorkflow:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.currentTaskWorkflowRule.firstResult.action?this.currentTaskWorkflowRule.lastResult.action=0:this.currentTaskWorkflowRule.lastResult.action=3;var o={taskWorkflowName:this.currentTaskWorkflowRule.taskWorkflowName,taskWorkflowRules:JSON.stringify(this.currentTaskWorkflowRule)};e&&(this.taskWorkflow?(o.taskWorkflowCode=this.taskWorkflow.code,u(o).then((function(e){t.getTaskWorkflowList()}))):(o.projectCode=this.code,l(o).then((function(e){t.getTaskWorkflowList()})))),this.doTaskWorkflowView=!1},getTaskStages:function(){var t=this;Object(p["a"])({projectCode:this.code}).then((function(e){var o=[{code:"",name:"不选择"}];e.data.forEach((function(t){o.push(t)})),t.taskStages=o}))},getTaskWorkflowRules:function(t){var e=this;c({taskWorkflowCode:t}).then((function(t){e.loadingWorkflowRule=!1;var o=t.data;e.taskWorkflowRuleList=o,o&&(e.currentTaskWorkflowRule.firstObj=o[0].object_code,e.currentTaskWorkflowRule.firstAction.action=o[1].action,e.currentTaskWorkflowRule.firstAction.value=o[1].object_code,e.currentTaskWorkflowRule.firstResult.action=o[2].action,e.currentTaskWorkflowRule.firstResult.value=o[2].object_code,o.length>=4&&(o[3].object_code?(e.currentTaskWorkflowRule.lastResult.action=o[3].action,e.currentTaskWorkflowRule.lastResult.value=o[3].object_code):(e.currentTaskWorkflowRule.state.action=o[3].action,e.currentTaskWorkflowRule.state.value=o[3].action),o.length>=5&&(o[4].object_code?(e.currentTaskWorkflowRule.lastResult.action=o[4].action,e.currentTaskWorkflowRule.lastResult.value=o[4].object_code):(e.currentTaskWorkflowRule.state.action=o[4].action,e.currentTaskWorkflowRule.state.value=o[4].action))))}))},delTaskWorkflow:function(t){var e=this;this.$confirm({title:"删除规则?",content:"您确定要删除该规则吗？",okText:"删除",okType:"danger",cancelText:"再想想",onOk:function(){return f({taskWorkflowCode:t}).then((function(t){Object(v["a"])(t)&&e.getTaskWorkflowList()})),Promise.resolve()}})},getProjectMembers:function(){var t=this;Object(d["c"])({projectCode:this.code,pageSize:100}).then((function(e){var o=[{code:"",name:"不选择"}];e.data.list.forEach((function(t){o.push(t)})),t.projectMembers=o}))},workflowRuleChange:function(t,e){console.log(t),console.log(e),"firstAction.action"==e&&(this.currentTaskWorkflowRule.firstAction.value=""),"firstResult.value"==e&&(this.currentTaskWorkflowRule.lastResult.value=""),"firstResult.action"==e&&(this.currentTaskWorkflowRule.firstResult.value="",this.currentTaskWorkflowRule.lastResult.value="")},handleChange:function(t){var e=this;"uploading"!==t.file.status?"done"===t.file.status&&Object(v["e"])(t.file.originFileObj,(function(){e.project.cover=t.file.response.data.url,e.uploadLoading=!1,Object(k["b"])({title:"封面上传成功"},"notice","success")})):this.uploadLoading=!0},beforeUpload:function(t){var e=t.size/1024/1024<2;return e||this.$message.error("图片不能超过2MB!"),e}}},h=m,w=(o("9c6f"),o("2877")),j=Object(w["a"])(h,a,r,!1,null,null,null);e["default"]=j.exports},"6be7":function(t,e,o){"use strict";o.d(e,"f",(function(){return r})),o.d(e,"l",(function(){return n})),o.d(e,"e",(function(){return s})),o.d(e,"g",(function(){return i})),o.d(e,"k",(function(){return c})),o.d(e,"i",(function(){return l})),o.d(e,"d",(function(){return u})),o.d(e,"j",(function(){return f})),o.d(e,"h",(function(){return p})),o.d(e,"c",(function(){return d})),o.d(e,"b",(function(){return k})),o.d(e,"a",(function(){return v}));var a=o("22b6");function r(t){return a["a"].post("project/project",t)}function n(t){return a["a"].post("project/project/selfList",t)}function s(t){var e="project/project/save";return t.projectCode&&(e="project/project/edit"),a["a"].post(e,t)}function i(t){return a["a"].post("project/project/quit",{projectCode:t})}function c(t){return a["a"].post("project/project/recycle",{projectCode:t})}function l(t){return a["a"].post("project/project/recovery",{projectCode:t})}function u(t){return a["a"].post("project/project/archive",{projectCode:t})}function f(t){return a["a"].post("project/project/recoveryArchive",{projectCode:t})}function p(t){return a["a"].post("project/project/read",{projectCode:t})}function d(t){return a["a"].post("project/project/analysis",t)}function k(t){return a["a"].post("project/project/_projectStats",t)}function v(t){return a["a"].post("project/project/_getProjectReport",t)}},"82f8":function(t,e,o){"use strict";o.d(e,"a",(function(){return r}));var a=o("22b6");function r(t){return a["a"].post("project/invite_link/save",t)}},"9c6f":function(t,e,o){"use strict";var a=o("a678"),r=o.n(a);r.a},"9f09":function(t,e,o){"use strict";o.d(e,"d",(function(){return r})),o.d(e,"a",(function(){return n})),o.d(e,"g",(function(){return s})),o.d(e,"f",(function(){return i})),o.d(e,"e",(function(){return c})),o.d(e,"c",(function(){return l})),o.d(e,"b",(function(){return u}));var a=o("22b6");function r(t){return a["a"].post("project/task_stages",t)}function n(t){return a["a"].post("project/task_stages/_getAll",t)}function s(t){return a["a"].post("project/task_stages/tasks",t)}function i(t,e,o){return a["a"].post("project/task_stages/sort",{preCode:t,nextCode:e,projectCode:o})}function c(t){return a["a"].post("project/task_stages/save",t)}function l(t){return a["a"].post("project/task_stages/edit",t)}function u(t){return a["a"].post("project/task_stages/delete",{code:t})}},"9f5d":function(t,e,o){"use strict";o.d(e,"d",(function(){return r})),o.d(e,"b",(function(){return n})),o.d(e,"c",(function(){return s})),o.d(e,"a",(function(){return i}));var a=o("22b6");function r(t,e){return a["a"].post("project/project_member/searchInviteMember",{keyword:t,projectCode:e})}function n(t,e){return a["a"].post("project/project_member/inviteMember",{memberCode:t,projectCode:e})}function s(t){return a["a"].post("project/project_member/index",t)}function i(t){return a["a"].post("project/project_member/_listForInvite",t)}},a678:function(t,e,o){},b54a:function(t,e,o){"use strict";o("386b")("link",(function(t){return function(e){return t(this,"a","href",e)}}))},c030:function(t,e,o){"use strict";o.d(e,"b",(function(){return r})),o.d(e,"a",(function(){return n})),o.d(e,"d",(function(){return s})),o.d(e,"c",(function(){return i}));var a=o("22b6");function r(t,e){return a["a"].post("project/project_member/inviteMember",{memberCode:t,projectCode:e})}function n(t){return a["a"].post("project/project_member/_joinByInviteLink",{inviteCode:t})}function s(t,e){return a["a"].post("project/project_member/removeMember",{memberCode:t,projectCode:e})}function i(t){return a["a"].post("project/project_member/index",t)}},d3a1:function(t,e,o){"use strict";o.r(e);var a=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("a-modal",{staticClass:"invite-project-member",attrs:{width:500,title:t.actionInfo.modalTitle,footer:null},on:{cancel:t.cancel},model:{value:t.actionInfo.modalStatus,callback:function(e){t.$set(t.actionInfo,"modalStatus",e)},expression:"actionInfo.modalStatus"}},[o("div",{staticClass:"header"},[o("span",[t._v("账号邀请")]),o("a",{on:{click:t.createInviteLink}},[t._v("通过链接邀请")])]),o("div",{staticClass:"search-content m-b"},[o("a-input",{attrs:{placeholder:"输入昵称或邮箱查找"},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}},[o("a-icon",{attrs:{slot:"prefix",type:"search"},slot:"prefix"})],1)],1),o("vue-scroll",[o("div",{staticClass:"member-list"},[o("a-list",{staticClass:"project-list",attrs:{itemLayout:"horizontal",loading:t.searching,dataSource:t.list,locale:{emptyText:t.keyword&&t.keyword.length>1?"没有搜索到相关成员":""}},scopedSlots:t._u([{key:"renderItem",fn:function(e){return o("a-list-item",{},[o("span",{attrs:{slot:"actions"},slot:"actions"},[e.joined?[o("a-icon",{attrs:{type:"user"}}),o("span",[t._v("已加入")])]:o("a-button",{attrs:{size:"small",type:"dashed",icon:"user-add"},on:{click:function(o){return t.invite(e)}}},[t._v("邀请")])],2),o("a-list-item-meta",{attrs:{description:e.email}},[o("span",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.name))]),o("a-avatar",{attrs:{slot:"avatar",icon:"user",src:e.avatar},slot:"avatar"})],1)],1)}}])})],1)])],1),o("a-modal",{staticClass:"invite-link",attrs:{width:600,title:t.linkInfo.modalTitle,footer:null},model:{value:t.linkInfo.modalStatus,callback:function(e){t.$set(t.linkInfo,"modalStatus",e)},expression:"linkInfo.modalStatus"}},[o("div",{staticClass:"header"},[o("p",[t._v("链接有效日期："+t._s(t.linkInfo.overTime))]),o("a-input-search",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:t.linkInfo.link,expression:"linkInfo.link",arg:"copy"}],attrs:{size:"large",enterButton:"复制链接"},model:{value:t.linkInfo.link,callback:function(e){t.$set(t.linkInfo,"link",e)},expression:"linkInfo.link"}})],1)])],1)},r=[],n=(o("28a5"),o("b54a"),o("386d"),o("c5f6"),o("2ef0")),s=o.n(n),i=o("9f5d"),c=o("2f14"),l=o("82f8"),u={name:"inviteProjectMember",props:{value:{type:Boolean,default:function(){return!1}},projectCode:{type:[String,Number],default:function(){return""}}},data:function(){return{form:this.$form.createForm(this),actionInfo:{modalStatus:this.value,confirmLoading:!1,modalTitle:"邀请新成员"},linkInfo:{modalStatus:!1,confirmLoading:!1,modalTitle:"邀请成员",link:"",overTime:""},keyword:"",searching:!1,list:[]}},watch:{value:function(t){this.actionInfo.modalStatus=t},keyword:function(){this.search()}},created:function(){this.getMembers()},methods:{getMembers:function(){var t=this;Object(i["a"])({projectCode:t.projectCode}).then((function(e){t.list=e.data}))},invite:function(t){Object(i["b"])(t.memberCode,this.projectCode).then((function(e){var o=Object(c["a"])(e);o&&(t.joined=!0)}))},createInviteLink:function(){var t=this;this.linkInfo.link?this.linkInfo.modalStatus=!0:Object(l["a"])({inviteType:"project",sourceCode:this.projectCode}).then((function(e){var o=Object(c["a"])(e);o&&(t.linkInfo.modalStatus=!0,t.linkInfo.link=window.location.href.split("#")[0]+"#/invite_from_link/"+e.data.code,t.linkInfo.overTime=moment(e.data.code.over_time).format("YYYY年M月D日 HH:mm"))}))},search:s.a.debounce((function(){var t=this;if(this.keyword||(this.list=[]),this.keyword.length<=1)return this.getMembers(),!1;this.searching=!0,Object(i["d"])(this.keyword,this.projectCode).then((function(e){t.searching=!1,t.list=e.data}))}),500),cancel:function(){this.actionInfo.modalStatus=!1,this.$emit("input",this.actionInfo.modalStatus)}}},f=u,p=(o("3ed7"),o("2877")),d=Object(p["a"])(f,a,r,!1,null,null,null);e["default"]=d.exports},e55b:function(t,e,o){"use strict";o.d(e,"a",(function(){return r}));var a=o("22b6");function r(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"collect";return a["a"].post("project/project_collect/collect",{type:e,projectCode:t})}}}]);