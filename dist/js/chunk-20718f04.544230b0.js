(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-20718f04"],{"1b80":function(t,e,a){"use strict";e["a"]={data:function(){return{pagination:{page:1,pageSize:10,total:0,showTotal:function(t,e){return"共 ".concat(t," 条")}}}},computed:{requestData:function(){return{page:this.pagination.page,pageSize:this.pagination.pageSize}}},methods:{init:function(){},pageChange:function(t){this.pagination.page=t,this.requestData.page=t.current,this.init()}}}},"590f":function(t,e,a){},"5cd4":function(t,e,a){"use strict";var o=a("590f"),n=a.n(o);n.a},6061:function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"project-template-index"},[a("wrapper-content",{attrs:{showHeader:!1}},[a("a-tabs",{attrs:{animated:!1},model:{value:t.viewType,callback:function(e){t.viewType=e},expression:"viewType"}},[a("a-tab-pane",{key:"0",attrs:{tab:"自定义模板"}}),a("a-tab-pane",{key:"1",attrs:{tab:"公共模板"}}),a("a-button",{attrs:{slot:"tabBarExtraContent",type:"primary",icon:"plus"},on:{click:function(e){return t.doAction(null,"new")}},slot:"tabBarExtraContent"},[t._v("制作项目模板")])],1),a("a-list",{staticClass:"default-list",attrs:{loading:t.loading,itemLayout:"horizontal",dataSource:t.dataSource},scopedSlots:t._u([{key:"renderItem",fn:function(e,o){return a("a-list-item",{},[e.is_system?t._e():a("span",{attrs:{slot:"actions"},on:{click:function(a){return t.doAction(e,"stages")}},slot:"actions"},[a("a-tooltip",{attrs:{title:"任务列表"}},[a("a-icon",{attrs:{type:"bars"}})],1)],1),e.is_system?t._e():a("span",{attrs:{slot:"actions"},on:{click:function(a){return t.doAction(e,"edit")}},slot:"actions"},[a("a-tooltip",{attrs:{title:"编辑"}},[a("a-icon",{attrs:{type:"edit"}})],1)],1),e.is_system?t._e():a("span",{attrs:{slot:"actions"},on:{click:function(a){return t.doAction(e,"del",o)}},slot:"actions"},[a("a-tooltip",{attrs:{title:"删除"}},[a("a-icon",{attrs:{type:"delete"}})],1)],1),a("a-list-item-meta",{attrs:{description:e.description}},[a("span",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.name))]),a("a-avatar",{attrs:{slot:"avatar",icon:"user",src:e.cover},slot:"avatar"})],1),a("div",{staticClass:"other-info muted"},[e.task_stages.length?a("div",{staticClass:"info-item task"},[a("a-breadcrumb",{attrs:{separator:">"}},t._l(e.task_stages,(function(e){return a("a-breadcrumb-item",{key:e.name},[t._v(t._s(e.name))])})),1)],1):t._e()])],1)}}])},[t.showLoadingMore?a("div",{style:{textAlign:"center",marginTop:"12px",height:"32px",lineHeight:"32px"},attrs:{slot:"loadMore"},slot:"loadMore"},[t.loadingMore?a("a-spin"):a("a-button",{on:{click:t.onLoadMore}},[t._v("查看更多模板")])],1):t._e()])],1),a("a-modal",{staticClass:"project-template-modal",attrs:{width:360,title:t.actionInfo.modalTitle,bodyStyle:{paddingBottom:"1px"},footer:null},model:{value:t.actionInfo.modalStatus,callback:function(e){t.$set(t.actionInfo,"modalStatus",e)},expression:"actionInfo.modalStatus"}},[a("a-form",{attrs:{form:t.form},on:{submit:function(e){return e.preventDefault(),t.handleSubmit(e)}}},[a("div",{staticClass:"cover-item"},[t.cover?[a("img",{staticClass:"avatar",attrs:{src:t.cover}})]:t._e(),a("span",{directives:[{name:"show",rawName:"v-show",value:!t.cover,expression:"!cover"}],staticClass:"no-avatar"}),a("a-upload",{staticClass:"cover-uploader",attrs:{name:"cover",showUploadList:!1,headers:t.headers,action:t.uploadAction,beforeUpload:t.beforeUpload},on:{change:t.handleChange}},[a("a-button",{staticClass:"upload",attrs:{icon:"upload"}},[t._v("上传封面")]),a("span",{staticClass:"upload-tips muted"},[t._v("最佳图片比例为300*150")])],1)],2),a("a-form-item",[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,message:"请输入模板名称"}]}],expression:"[\n                                          'name',\n                                          {rules: [{ required: true, message: '请输入模板名称' }]}\n                                          ]"}],attrs:{placeholder:"模板名称（必填）"}})],1),a("a-form-item",[a("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["description"],expression:"['description']"}],attrs:{placeholder:"模板说明",rows:2}})],1),a("a-form-item",[a("div",{staticClass:"action-btn"},[a("a-button",{staticClass:"middle-btn",attrs:{type:"primary",htmlType:"submit",block:"",size:"large",loading:t.actionInfo.confirmLoading}},[t._v("保存模板")])],1)])],1)],1)],1)},n=[],i=(a("7f7f"),a("22b6"));function s(t){return i["a"].post("project/project_template",t)}function r(t){var e="project/project_template/save";return t.code&&(e="project/project_template/edit"),i["a"].post(e,t)}function c(t){return i["a"].post("project/project_template/delete",{code:t})}var l=a("2f14"),d=a("1b80"),u=(a("a078"),{components:{},mixins:[d["a"]],data:function(){return{viewType:"0",dataSource:[],loading:!0,showLoadingMore:!1,loadingMore:!1,currentTemplate:{},cover:"https://beta.vilson.xyz/static/image/default/project-cover.png",newData:{id:0},form:this.$form.createForm(this),searchForm:{},actionInfo:{modalStatus:!1,confirmLoading:!1,modalTitle:"编辑模板"},uploadLoading:!1,uploadAction:Object(l["c"])("project/project_template/uploadCover")}},computed:{headers:function(){return Object(l["d"])()}},watch:{$route:function(){this.init()},viewType:function(){this.init()}},created:function(){this.init()},methods:{init:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this;t&&(this.dataSource=[],this.pagination.page=1,this.showLoadingMore=!1),e.loading=!0,e.requestData.viewType=e.viewType,s(e.requestData).then((function(t){e.dataSource=e.dataSource.concat(t.data.list),e.pagination.total=t.data.total,e.showLoadingMore=e.pagination.total>e.dataSource.length,e.loading=!1,e.loadingMore=!1}))},onLoadMore:function(){this.loadingMore=!0,this.pagination.page++,this.init(!1)},doAction:function(t,e,a){this.currentTemplate=t;var o=this;if(o.newData={code:""},"edit"==e||"new"==e)setTimeout((function(){o.form&&o.form.resetFields()}),0),o.actionInfo.modalStatus=!0,o.actionInfo.modalTitle="自定义模板","edit"==e&&setTimeout((function(){o.actionInfo.modalTitle="编辑模板",o.form.setFieldsValue({name:t.name,description:t.description}),o.cover=t.cover,o.newData=t}),0);else if("del"==e)this.$confirm({title:"确定删除模板？",content:"删除模板「".concat(this.currentTemplate.name,"」后已从该模板创建的项目不受影响"),okText:"删除模板",okType:"danger",cancelText:"再想想",onOk:function(){return c(t.code).then((function(){o.dataSource.splice(a,1)})),Promise.resolve()}});else if("stages"==e){var n=this.$router.resolve({path:"/project/template/taskstages/"+t.code+"?name="+t.name}),i=n.href;window.open(i,"_blank")}},handleSubmit:function(){var t=this;t.form.validateFields((function(e){e||t.handleOk()}))},handleOk:function(){var t=this;t.actionInfo.confirmLoading=!0;var e=t.form.getFieldsValue();e.cover=this.cover,t.newData.code?e.code=t.newData.code:Object.assign(e,t.newData),r(e).then((function(e){t.actionInfo.confirmLoading=!1,Object(l["a"])(e)&&(t.form.resetFields(),t.newData={code:""},t.actionInfo.modalStatus=!1,t.init())}))},handleChange:function(t){var e=this;"uploading"!==t.file.status?"done"===t.file.status&&Object(l["e"])(t.file.originFileObj,(function(a){e.cover=t.file.response.data.url,e.uploadLoading=!1})):this.uploadLoading=!0},beforeUpload:function(t){var e=t.size/1024/1024<2;return e||this.$message.error("图片不能超过2MB!"),e}}}),p=u,m=(a("5cd4"),a("2877")),f=Object(m["a"])(p,o,n,!1,null,null,null);e["default"]=f.exports}}]);