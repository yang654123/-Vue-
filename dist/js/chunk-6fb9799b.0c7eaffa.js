(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6fb9799b"],{"1b80":function(t,e,a){"use strict";e["a"]={data:function(){return{pagination:{page:1,pageSize:10,total:0,showTotal:function(t,e){return"共 ".concat(t," 条")}}}},computed:{requestData:function(){return{page:this.pagination.page,pageSize:this.pagination.pageSize}}},methods:{init:function(){},pageChange:function(t){this.pagination.page=t,this.requestData.page=t.current,this.init()}}}},"2f21":function(t,e,a){"use strict";var o=a("79e5");t.exports=function(t,e){return!!t&&o((function(){e?t.call(null,(function(){}),1):t.call(null)}))}},5515:function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"project-template-index"},[a("wrapper-content",{attrs:{showHeader:!1}},[a("div",{staticClass:"action"},[a("a-button",{attrs:{type:"primary",icon:"plus"},on:{click:function(e){return t.doAction(null,"new")}}},[t._v("添加任务")])],1),a("h3",[t._v("「"+t._s(t.$route.query.name)+"」任务列表")]),a("a-list",{staticClass:"default-list",attrs:{loading:t.loading,itemLayout:"horizontal",dataSource:t.dataSource},scopedSlots:t._u([{key:"renderItem",fn:function(e,o){return a("a-list-item",{},[a("span",{attrs:{slot:"actions"},on:{click:function(a){return t.doAction(e,"edit")}},slot:"actions"},[a("a-tooltip",{attrs:{title:"编辑"}},[a("a-icon",{attrs:{type:"edit"}})],1)],1),a("span",{attrs:{slot:"actions"},on:{click:function(a){return t.doAction(e,"del",o)}},slot:"actions"},[a("a-tooltip",{attrs:{title:"删除"}},[a("a-icon",{attrs:{type:"delete"}})],1)],1),a("a-list-item-meta",{attrs:{description:"排序："+e.sort}},[a("span",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.name))])])],1)}}])},[t.showLoadingMore?a("div",{style:{textAlign:"center",marginTop:"12px",height:"32px",lineHeight:"32px"},attrs:{slot:"loadMore"},slot:"loadMore"},[t.loadingMore?a("a-spin"):a("a-button",{on:{click:t.onLoadMore}},[t._v("查看更多任务")])],1):t._e()])],1),a("a-modal",{attrs:{width:360,title:t.actionInfo.modalTitle,bodyStyle:{paddingBottom:"1px"},footer:null},model:{value:t.actionInfo.modalStatus,callback:function(e){t.$set(t.actionInfo,"modalStatus",e)},expression:"actionInfo.modalStatus"}},[a("a-form",{attrs:{form:t.form},on:{submit:function(e){return e.preventDefault(),t.handleSubmit(e)}}},[a("a-form-item",[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,message:"请输入任务名称"}]}],expression:"[\n                                        'name',\n                                        {rules: [{ required: true, message: '请输入任务名称' }]}\n                                        ]"}],attrs:{placeholder:"任务名称（必填）"}})],1),a("a-form-item",{attrs:{help:"排序，值越大越靠前，默认0"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["sort"],expression:"[\n                                        'sort',\n                                        ]"}],staticStyle:{width:"100%"},attrs:{min:0,placeholder:"排序"}})],1),a("a-form-item",[a("div",{staticClass:"action-btn"},[a("a-button",{staticClass:"middle-btn",attrs:{type:"primary",htmlType:"submit",block:"",size:"large",loading:t.actionInfo.confirmLoading}},[t._v("保存任务\n                    ")])],1)])],1)],1)],1)},n=[],i=(a("55dd"),a("7f7f"),a("22b6"));function r(t){return i["a"].post("project/task_stages_template",t)}function s(t){var e="project/task_stages_template/save";return t.code&&(e="project/task_stages_template/edit"),i["a"].post(e,t)}function c(t){return i["a"].post("project/task_stages_template/delete",{code:t})}var l=a("2f14"),u=a("1b80"),d={components:{},mixins:[u["a"]],data:function(){return{dataSource:[],loading:!0,showLoadingMore:!1,loadingMore:!1,currentTemplate:{},newData:{id:0},form:this.$form.createForm(this),searchForm:{},actionInfo:{modalStatus:!1,confirmLoading:!1,modalTitle:"编辑任务"}}},watch:{$route:function(){this.init()},viewType:function(){this.init()}},created:function(){this.init()},methods:{init:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this;t&&(this.dataSource=[],this.pagination.page=1,this.showLoadingMore=!1),e.loading=!0,e.requestData.code=e.$route.params.code,r(e.requestData).then((function(t){e.dataSource=e.dataSource.concat(t.data.list),e.pagination.total=t.data.total,e.showLoadingMore=e.pagination.total>e.dataSource.length,e.loading=!1,e.loadingMore=!1}))},onLoadMore:function(){this.loadingMore=!0,this.pagination.page++,this.init(!1)},doAction:function(t,e,a){this.currentTemplate=t;var o=this;o.newData={code:""},"edit"==e||"new"==e?(setTimeout((function(){o.form&&o.form.resetFields()}),0),o.actionInfo.modalStatus=!0,o.actionInfo.modalTitle="添加任务","edit"==e&&setTimeout((function(){o.actionInfo.modalTitle="编辑任务",o.form.setFieldsValue({name:t.name,sort:t.sort}),o.cover=t.cover,o.newData=t}),0)):"del"==e&&this.$confirm({title:"确定删除任务？",content:"删除任务「".concat(this.currentTemplate.name,"」后已以该任务创建的项目不受影响"),okText:"删除任务",okType:"danger",cancelText:"再想想",onOk:function(){return c(t.code).then((function(){o.dataSource.splice(a,1)})),Promise.resolve()}})},handleSubmit:function(){var t=this;t.form.validateFields((function(e){e||t.handleOk()}))},handleOk:function(){var t=this;t.actionInfo.confirmLoading=!0;var e=t.form.getFieldsValue();e.template_code=this.$route.params.code,t.newData.code?e.code=t.newData.code:Object.assign(e,t.newData),s(e).then((function(e){t.actionInfo.confirmLoading=!1,Object(l["a"])(e)&&(t.form.resetFields(),t.newData={code:""},t.actionInfo.modalStatus=!1,t.init())}))},handleChange:function(t){var e=this;"uploading"!==t.file.status?"done"===t.file.status&&Object(l["e"])(t.file.originFileObj,(function(a){e.cover=t.file.response.data.url,e.uploadLoading=!1})):this.uploadLoading=!0},beforeUpload:function(t){var e=t.size/1024/1024<2;return e||this.$message.error("图片不能超过2MB!"),e}}},f=d,p=a("2877"),m=Object(p["a"])(f,o,n,!1,null,null,null);e["default"]=m.exports},"55dd":function(t,e,a){"use strict";var o=a("5ca1"),n=a("d8e8"),i=a("4bf8"),r=a("79e5"),s=[].sort,c=[1,2,3];o(o.P+o.F*(r((function(){c.sort(void 0)}))||!r((function(){c.sort(null)}))||!a("2f21")(s)),"Array",{sort:function(t){return void 0===t?s.call(i(this)):s.call(i(this),n(t))}})}}]);