(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7c1ffe66","chunk-ccd145dc","chunk-2d0df843"],{"725c":function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("a-card",{staticStyle:{height:"100%"},attrs:{bordered:!1}},[n("div",{staticClass:"table-operator"},[t.buttonSwitch.add?n("a-button",{attrs:{type:"primary",icon:"plus"},on:{click:t.handleAdd}},[t._v("新增")]):t._e(),t.buttonSwitch.import?n("a-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"primary",icon:"upload"},on:{click:t.handleImportXls}},[t._v("导入")]):t._e(),t.buttonSwitch.export?n("a-button",{staticStyle:{"margin-left":"8px"},attrs:{type:"primary",icon:"download"},on:{click:t.handleExportXls}},[t._v("导出")]):t._e(),t._l(t.cgButtonList,(function(e,i){return t.cgButtonList&&t.cgButtonList.length>0?["js"==e.optType?n("a-button",{key:"cgbtn"+i,staticStyle:{"margin-left":"8px"},attrs:{type:"primary",icon:e.buttonIcon},on:{click:function(n){return t.cgButtonJsHandler(e.buttonCode)}}},[t._v("\n        "+t._s(e.buttonName)+"\n      ")]):"action"==e.optType?n("a-button",{key:"cgbtn"+i,staticStyle:{"margin-left":"8px"},attrs:{type:"primary",icon:e.buttonIcon},on:{click:function(n){return t.cgButtonActionHandler(e.buttonCode)}}},[t._v("\n        "+t._s(e.buttonName)+"\n      ")]):t._e()]:t._e()})),t.buttonSwitch.batch_delete?n("a-button",{directives:[{name:"show",rawName:"v-show",value:t.selectedRowKeys.length>0,expression:"selectedRowKeys.length > 0"}],staticStyle:{"margin-left":"8px"},attrs:{ghost:"",type:"primary",icon:"delete"},on:{click:t.handleDelBatch}},[t._v("批量删除")]):t._e()],2),n("div",[n("div",{staticClass:"ant-alert ant-alert-info",staticStyle:{"margin-bottom":"16px"}},[n("i",{staticClass:"anticon anticon-info-circle ant-alert-icon"}),t._v("\n      已选择 "),n("a",{staticStyle:{"font-weight":"600"}},[t._v(t._s(t.selectedRowKeys.length))]),t._v("项  \n      "),n("a",{staticStyle:{"margin-left":"24px"},on:{click:t.onClearSelected}},[t._v("清空")])]),n("a-table",t._b({ref:"cgformTreeList",staticStyle:{"min-height":"300px"},attrs:{size:"middle",rowKey:"id",columns:t.columns,dataSource:t.dataSource,pagination:t.pagination,loading:t.loading,expandedRowKeys:t.expandedRowKeys},on:{change:t.handleTableChange,expand:t.handleExpand},scopedSlots:t._u([{key:"dateSlot",fn:function(e){return[n("span",[t._v(t._s(t.getDateNoTime(e)))])]}},{key:"htmlSlot",fn:function(e){return[n("div",{domProps:{innerHTML:t._s(e)}})]}},{key:"imgSlot",fn:function(e){return[e?n("img",{staticStyle:{"max-width":"80px","font-size":"12px","font-style":"italic"},attrs:{src:t.getImgView(e),height:"25px",alt:"图片不存在"}}):n("span",{staticStyle:{"font-size":"12px","font-style":"italic"}},[t._v("无此图片")])]}},{key:"fileSlot",fn:function(e){return[e?n("a-button",{attrs:{ghost:!0,type:"primary",icon:"download",size:"small"},on:{click:function(n){return t.uploadFile(e)}}},[t._v("\n          下载\n        ")]):n("span",{staticStyle:{"font-size":"12px","font-style":"italic"}},[t._v("无此文件")])]}},{key:"action",fn:function(e,i){return n("span",{},[t.buttonSwitch.update?[n("a",{on:{click:function(e){return t.handleEdit(i)}}},[t._v("编辑")]),n("a-divider",{attrs:{type:"vertical"}})]:t._e(),n("a-dropdown",[n("a",{staticClass:"ant-dropdown-link"},[t._v(" 更多 "),n("a-icon",{attrs:{type:"down"}})],1),n("a-menu",{attrs:{slot:"overlay"},slot:"overlay"},[n("a-menu-item",[n("a",{on:{click:function(e){return t.handleDetail(i)}}},[t._v("详情")])]),t.buttonSwitch.delete?n("a-menu-item",[n("a-popconfirm",{attrs:{title:"确定删除吗?"},on:{confirm:function(){return t.handleDeleteOne(i)}}},[n("a",[t._v("删除")])])],1):t._e(),t._l(t.cgButtonLinkList,(function(e,o){return t.cgButtonLinkList&&t.cgButtonLinkList.length>0?[n("a-menu-item",{key:"cgbtnLink"+o},[n("a",{attrs:{href:"javascript:void(0);"},on:{click:function(n){return t.cgButtonLinkHandler(i,e.buttonCode,e.optType)}}},[e.buttonIcon?n("a-icon",{attrs:{type:e.buttonIcon}}):t._e(),t._v("\n                  "+t._s(e.buttonName)+"\n                ")],1)])]:t._e()}))],2)],1)],2)}}])},"a-table",t.tableProps,!1)),n("onl-cgform-auto-modal",{ref:"modal",attrs:{code:t.code},on:{success:t.handleFormSuccess}}),n("j-import-modal",{ref:"importModal",attrs:{url:t.getImportUrl()},on:{ok:t.importOk}})],1)])},o=[],a=n("d89d"),s=a["a"],r=(n("76fa"),n("2877")),c=Object(r["a"])(s,i,o,!1,null,null,null);e["default"]=c.exports},"76fa":function(t,e,n){"use strict";var i=n("c1d5"),o=n.n(i);o.a},"7c93":function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("a-modal",{attrs:{title:"导入EXCEL",width:600,visible:t.visible,confirmLoading:t.uploading},on:{cancel:t.handleClose}},[n("a-upload",{attrs:{name:"file",multiple:!0,accept:".xls,.xlsx",fileList:t.fileList,remove:t.handleRemove,beforeUpload:t.beforeUpload}},[n("a-button",[n("a-icon",{attrs:{type:"upload"}}),t._v("\n      选择导入文件\n    ")],1)],1),n("template",{slot:"footer"},[n("a-button",{on:{click:t.handleClose}},[t._v("关闭")]),n("a-button",{attrs:{type:"primary",disabled:0===t.fileList.length,loading:t.uploading},on:{click:t.handleImport}},[t._v("\n      "+t._s(t.uploading?"上传中...":"开始上传")+"\n    ")])],1)],2)},o=[],a=(n("ac6a"),n("75fc")),s=n("0fea"),r={name:"JImportModal",props:{url:{type:String,default:"",required:!1},biz:{type:String,default:"",required:!1}},data:function(){return{visible:!1,uploading:!1,fileList:[],uploadAction:"",foreignKeys:""}},watch:{url:function(t){t&&(this.uploadAction=window._CONFIG["domianURL"]+t)}},created:function(){this.uploadAction=window._CONFIG["domianURL"]+this.url},methods:{handleClose:function(){this.visible=!1},show:function(t){this.fileList=[],this.uploading=!1,this.visible=!0,this.foreignKeys=t},handleRemove:function(t){var e=this.fileList.indexOf(t),n=this.fileList.slice();n.splice(e,1),this.fileList=n},beforeUpload:function(t){return this.fileList=[].concat(Object(a["a"])(this.fileList),[t]),!1},handleImport:function(){var t=this,e=this.fileList,n=new FormData;this.biz&&n.append("isSingleTableImport",this.biz),this.foreignKeys&&this.foreignKeys.length>0&&n.append("foreignKeys",this.foreignKeys),e.forEach((function(t){n.append("files[]",t)})),this.uploading=!0,Object(s["postAction"])(this.uploadAction,n).then((function(e){t.uploading=!1,e.success?(t.$message.success(e.message),t.visible=!1,t.$emit("ok")):t.$message.warning(e.message)}))}}},c=r,l=n("2877"),_=Object(l["a"])(c,i,o,!1,null,"495e2a21",null);e["default"]=_.exports},"89f2":function(t,e,n){"use strict";n.d(e,"c",(function(){return a})),n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return c}));n("96cf"),n("28a5"),n("6b54"),n("ac4d"),n("8a81"),n("ac6a");var i=n("3b8d"),o=n("4ec3");n("0fea");function a(t){return s.apply(this,arguments)}function s(){return s=Object(i["a"])(regeneratorRuntime.mark((function t(e){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return","字典Code不能为空!");case 2:return t.next=4,Object(o["f"])(e);case 4:return n=t.sent,t.abrupt("return",n);case 6:case"end":return t.stop()}}),t)}))),s.apply(this,arguments)}function r(t,e){if(t instanceof Array){var n=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var r=a.value;if(e===r.value)return r.text}}catch(c){i=!0,o=c}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}}return e}function c(t,e){if(0===e||"0"===e){var n=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var r=a.value;if(e==r.value)return r.text}}catch(_){i=!0,o=_}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}}if(!e||!t||0==t.length)return"";var c="";e=e.toString();var l=e.split(",");return t.forEach((function(t){for(var e=0;e<l.length;e++)if(l[e]===t.value){c+=t.text+",";break}})),""==c?e:c.substring(0,c.length-1)}},c1d5:function(t,e,n){},d89d:function(module,__webpack_exports__,__webpack_require__){"use strict";var core_js_modules_es6_object_keys__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("456d"),core_js_modules_es6_object_keys__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_es6_object_keys__WEBPACK_IMPORTED_MODULE_0__),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("ac6a"),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_1__),core_js_modules_es6_number_constructor__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("c5f6"),core_js_modules_es6_number_constructor__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(core_js_modules_es6_number_constructor__WEBPACK_IMPORTED_MODULE_2__),_Users_yunwisdom_Workspace_oa_front_service_node_modules_babel_runtime_corejs2_helpers_esm_toConsumableArray__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("75fc"),_api_manage__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("0fea"),_components_dict_JDictSelectUtil__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("89f2"),_utils_util__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("ca00"),_components_jeecg_JImportModal__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("7c93");__webpack_exports__["a"]={name:"OnlCgformTreeList",components:{JImportModal:_components_jeecg_JImportModal__WEBPACK_IMPORTED_MODULE_7__["default"]},data:function(){return{code:"87b55a515d3441b6b98e48e5b35474a6",description:"在线报表功能测试页面",currentTableName:"",pidField:"",hasChildrenField:"",textField:"",loading:!1,columns:[],dataSource:[],selectedRowKeys:[],selectionRows:[],pagination:{current:1,pageSize:10,pageSizeOptions:["10","20","30"],showTotal:function(t,e){return e[0]+"-"+e[1]+" 共"+t+"条"},showQuickJumper:!0,showSizeChanger:!0,total:0},url:{getColumns:"/online/cgform/api/getColumns/",getTreeData:"/online/cgform/api/getTreeData/",optPre:"/online/cgform/api/form/",exportXls:"/online/cgform/api/exportXls/",buttonAction:"/online/cgform/api/doButton",startProcess:"/process/extActProcess/startMutilProcess"},isorter:{column:"create_time",order:"desc"},dictOptions:{},queryParam:{},actionColumn:{title:"操作",dataIndex:"action",scopedSlots:{customRender:"action"},fixed:"right",align:"center",width:150},formTemplate:"99",cgButtonLinkList:[],cgButtonList:[],EnhanceJS:"",buttonSwitch:{add:!0,update:!0,delete:!0,batch_delete:!0,import:!0,export:!0},expandedRowKeys:[]}},created:function(){var t=this;this.initAutoListConfig().then((function(){t.loadData(1)})).catch((function(t){console.log(t)}))},mounted:function(){},watch:{$route:function(){var t=this;this.initAutoListConfig().then((function(){t.loadData(1)})).catch((function(t){console.log(t)}))}},computed:{tableProps:function(){var t=this;return{rowSelection:{selectedRowKeys:t.selectedRowKeys,onChange:function(e){return t.selectedRowKeys=e}}}}},methods:{resetData:function(){this.description="",this.currentTableName="",this.pidField="",this.hasChildrenField="",this.textField="",this.columns=[],this.dataSource=[],this.selectedRowKeys=[],this.selectionRows=[]},initAutoListConfig:function(){var t=this;return new Promise((function(e,n){t.$route.params.code?(t.resetData(),t.loading=!0,t.code=t.$route.params.code,Object(_api_manage__WEBPACK_IMPORTED_MODULE_4__["getAction"])("".concat(t.url.getColumns).concat(t.code)).then((function(i){console.log("--onlineList-加载动态列>>",i),i.success?(t.configInfohandler(i),e()):n("onlineList-加载表配置信息失败"),t.loading=!1})).catch((function(t){n(t)}))):n("列表加载需要参数CODE为空!")}))},configInfohandler:function(t){var e=this;this.dictOptions=t.result.dictOptions,this.formTemplate=t.result.formTemplate,this.description=t.result.description,this.currentTableName=t.result.currentTableName,this.pidField=t.result.pidField,this.hasChildrenField=t.result.hasChildrenField,this.textField=t.result.textField,this.initCgButtonList(t.result.cgButtonList),this.initCgEnhanceJs(t.result.enhanceJs),this.initButtonSwitch(t.result.hideColumns);for(var n=t.result.columns,i=-1,o=0;o<n.length;o++)n[o].align="left",this.textField==n[o].dataIndex&&(i=o),n[o].customRender&&function(){var t=n[o].customRender;n[o].customRender=function(n){return Object(_components_dict_JDictSelectUtil__WEBPACK_IMPORTED_MODULE_5__["b"])(e.dictOptions[t],n)}}();if(-1!=i){var a=n.splice(i,1);n.unshift(a[0])}n.push(this.actionColumn),this.columns=Object(_Users_yunwisdom_Workspace_oa_front_service_node_modules_babel_runtime_corejs2_helpers_esm_toConsumableArray__WEBPACK_IMPORTED_MODULE_3__["a"])(n)},loadData:function(t){var e=this;1==t&&(this.pagination.current=1),this.loading=!0,this.expandedRowKeys=[];var n=this.getQueryParams();n[this.pidField]="0",console.log("--onlineList-查询条件--\x3e",n),Object(_api_manage__WEBPACK_IMPORTED_MODULE_4__["getAction"])("".concat(this.url.getTreeData).concat(this.code),n).then((function(t){if(console.log("--onlineList-列表数据",t),t.success){var n=t.result;if(Number(n.total)>0){e.pagination.total=Number(n.total);var i=t.result.records.map((function(t){if(!0===t[e.hasChildrenField]||"1"==t[e.hasChildrenField]){var n={id:"".concat(t.id,"_loadChild"),name:"loading...",isLoading:!0};t.children=[n]}return t}));e.dataSource=i}else e.pagination.total=0,e.dataSource=[]}else e.$message.warning(t.message);e.loading=!1}))},handleExpand:function(t,e){var n=this;if(t){if(this.expandedRowKeys.push(e.id),e.children.length>0&&!0===e.children[0].isLoading){var i=this.getQueryParams();i[this.pidField]=e.id,Object(_api_manage__WEBPACK_IMPORTED_MODULE_4__["getAction"])("".concat(this.url.getTreeData).concat(this.code),i).then((function(t){if(t.success)if(Number(t.result.total)>0){var i=t.result.records.map((function(t){if(!0===t[n.hasChildrenField]||"1"==t[n.hasChildrenField]){var e={id:"".concat(t.id,"_loadChild"),name:"loading...",isLoading:!0};t.children=[e]}return t}));e.children=i}else e.children="",e.hasChildrenField="0";else n.$message.warning(t.message)}))}}else{var o=this.expandedRowKeys.indexOf(e.id);o>=0&&this.expandedRowKeys.splice(o,1)}},getQueryParams:function(){var t=Object.assign({},this.queryParam,this.isorter);return t.pageNo=this.pagination.current,t.pageSize=this.pagination.pageSize,Object(_utils_util__WEBPACK_IMPORTED_MODULE_6__["h"])(t)},initCgButtonList:function(t){var e=[],n=[];if(t&&t.length>0)for(var i=0;i<t.length;i++){var o=t[i];"button"==o.buttonStyle?n.push(o):"link"==o.buttonStyle&&e.push(o)}this.cgButtonLinkList=[].concat(e),this.cgButtonList=[].concat(n)},initCgEnhanceJs:function initCgEnhanceJs(enhanceJs){if(enhanceJs){var Obj=eval("("+enhanceJs+")");this.EnhanceJS=new Obj(_api_manage__WEBPACK_IMPORTED_MODULE_4__["getAction"],_api_manage__WEBPACK_IMPORTED_MODULE_4__["postAction"],_api_manage__WEBPACK_IMPORTED_MODULE_4__["deleteAction"]),this.cgButtonJsHandler("created")}else this.EnhanceJS=""},initButtonSwitch:function(t){var e=this;t&&t.length>0&&Object.keys(this.buttonSwitch).forEach((function(n){t.indexOf(n)>=0&&(e.buttonSwitch[n]=!1)}))},onClearSelected:function(){this.selectedRowKeys=[],this.selectionRows=[]},handleTableChange:function(t,e,n){Object.keys(n).length>0&&(this.isorter.column=n.field,this.isorter.order="ascend"==n.order?"asc":"desc"),this.pagination=t,this.loadData()},getDateNoTime:function(t){if(!t)return"";var e=t;return e.length>10&&(e=e.substring(0,10)),e},getImgView:function(t){return t&&t.indexOf(",")>0&&(t=t.substring(0,t.indexOf(","))),window._CONFIG["downloadURL"]+"/"+t},uploadFile:function(t){t?(t.indexOf(",")>0&&(t=t.substring(0,t.indexOf(","))),window.open(window._CONFIG["domainURL"]+"/sys/common/download/"+t)):this.$message.warning("未知的文件")},handleEdit:function(t){this.cgButtonLinkHandler(t,"beforeEdit","js"),this.$refs.modal.edit(this.formTemplate,t.id)},handleDetail:function(t){this.$refs.modal.detail(this.formTemplate,t.id)},handleDeleteOne:function(t){this.cgButtonLinkHandler(t,"beforeDelete","js"),this.handleDelete(t.id)},handleDelete:function(t){var e=this;Object(_api_manage__WEBPACK_IMPORTED_MODULE_4__["deleteAction"])(this.url.optPre+this.code+"/"+t).then((function(t){t.success?(e.$message.success(t.message),e.loadData()):e.$message.warning(t.message)}))},handleAdd:function(){this.cgButtonJsHandler("beforeAdd"),this.$refs.modal.add(this.formTemplate)},handleFormSuccess:function(){this.loadData()},handleImportXls:function(){this.$refs.importModal.show()},importOk:function(){this.loadData(1)},getImportUrl:function(){return"/online/cgform/api/importXls/"+this.code},handleExportXls:function(){var t=this,e=this.queryParam;this.selectedRowKeys&&this.selectedRowKeys.length>0&&(e["selections"]=this.selectedRowKeys.join(",")),console.log("导出参数",e);var n=JSON.stringify(Object(_utils_util__WEBPACK_IMPORTED_MODULE_6__["h"])(e));Object(_api_manage__WEBPACK_IMPORTED_MODULE_4__["downFile"])(this.url.exportXls+this.code,{paramsStr:n}).then((function(e){if(e)if("undefined"!==typeof window.navigator.msSaveBlob)window.navigator.msSaveBlob(new Blob([e]),t.description+".xls");else{var n=window.URL.createObjectURL(new Blob([e])),i=document.createElement("a");i.style.display="none",i.href=n,i.setAttribute("download",t.description+".xls"),document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(n)}else t.$message.warning("文件下载失败")}))},handleDelBatch:function(){if(this.selectedRowKeys.length<=0)return this.$message.warning("请选择一条记录！"),!1;var t="",e=this;e.selectedRowKeys.forEach((function(e){t+=e+","})),e.$confirm_({title:"确认删除",content:"是否删除选中数据?",onOk:function(){e.handleDelete(t),e.onClearSelected()}})},cgButtonLinkHandler:function(t,e,n){var i=this;if("js"==n)this.EnhanceJS[e]&&this.EnhanceJS[e](this,t);else if("action"==n){var o={formId:this.code,buttonCode:e,dataId:t.id};console.log("自定义按钮link请求后台参数：",o),Object(_api_manage__WEBPACK_IMPORTED_MODULE_4__["postAction"])(this.url.buttonAction,o).then((function(t){t.success?(i.loadData(),i.$message.success("处理完成!")):i.$message.warning("处理失败!")}))}},cgButtonJsHandler:function(t){this.EnhanceJS[t]&&this.EnhanceJS[t](this)},cgButtonActionHandler:function(t){var e=this;if(!this.selectedRowKeys||0==this.selectedRowKeys.length)return this.$message.warning("请先选中一条记录"),!1;if(this.selectedRowKeys.length>1)return this.$message.warning("请只选中一条记录"),!1;var n={formId:this.code,buttonCode:t,dataId:this.selectedRowKeys[0]};console.log("自定义按钮请求后台参数：",n),Object(_api_manage__WEBPACK_IMPORTED_MODULE_4__["postAction"])(this.url.buttonAction,n).then((function(t){t.success?(e.loadData(),e.$message.success("处理完成!")):e.$message.warning("处理失败!")}))}}}}}]);