(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-240bb3d3"],{"0610":function(t,e,a){"use strict";a.d(e,"b",(function(){return n})),a.d(e,"d",(function(){return i})),a.d(e,"c",(function(){return r})),a.d(e,"a",(function(){return c}));var s=a("22b6"),o=a("2f14");function n(t){return s["a"].post("project/file",t)}function i(){return Object(o["c"])("project/file/uploadFiles")}function r(t){return s["a"].post("project/file/recovery",{fileCode:t})}function c(t){return s["a"].post("project/file/delete",{fileCode:t})}},"0b47":function(t,e,a){},"19f2":function(t,e,a){"use strict";var s=a("cffd"),o=a.n(s);o.a},"1d80":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"task-search"},[a("a-spin",{attrs:{spinning:t.loading}},[a("div",{staticClass:"search-content"},[a("a-form",{staticClass:"m-t-md",attrs:{form:t.form},on:{submit:function(e){return e.preventDefault(),t.handleSubmit(e)}}},[a("a-form-item",{attrs:{label:"标题",colon:!1,labelCol:{span:6},wrapperCol:{span:18}}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["title"],expression:"[\n                                          'title',\n                                          ]"}],attrs:{placeholder:"搜索项目内任务"}})],1),a("a-form-item",{attrs:{label:"执行者",colon:!1,labelCol:{span:6},wrapperCol:{span:18}}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["executor"],expression:"[\n                                          'executor',\n                                          ]"}],attrs:{mode:"multiple",showSearch:"",allowClear:"",placeholder:"请选择",optionFilterProp:"children"}},t._l(t.projectMemberList,(function(e){return a("a-select-option",{key:e.code},[a("div",{staticClass:"task-search-member-item"},[a("a-avatar",{staticClass:"m-r-sm",attrs:{size:24,icon:"user",src:e.avatar}}),a("div",[a("div",[t._v(t._s(e.name))]),a("div",{staticClass:"muted"},[t._v(t._s(e.email))])])],1)])})),1)],1),a("a-form-item",{attrs:{label:"创建者",colon:!1,labelCol:{span:6},wrapperCol:{span:18}}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["creator"],expression:"[\n                                          'creator',\n                                          ]"}],attrs:{mode:"multiple",showSearch:"",allowClear:"",placeholder:"请选择",optionFilterProp:"children"}},t._l(t.projectMemberList,(function(e){return a("a-select-option",{key:e.code},[a("div",{staticClass:"task-search-member-item"},[a("a-avatar",{staticClass:"m-r-sm",attrs:{size:24,icon:"user",src:e.avatar}}),a("div",[a("div",[t._v(t._s(e.name))]),a("div",{staticClass:"muted"},[t._v(t._s(e.email))])])],1)])})),1)],1),a("a-form-item",{attrs:{label:"参与者",colon:!1,labelCol:{span:6},wrapperCol:{span:18}}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["joiner"],expression:"[\n                                          'joiner',\n                                          ]"}],attrs:{mode:"multiple",showSearch:"",allowClear:"",placeholder:"请选择",optionFilterProp:"children"}},t._l(t.projectMemberList,(function(e){return a("a-select-option",{key:e.code},[a("div",{staticClass:"task-search-member-item"},[a("a-avatar",{staticClass:"m-r-sm",attrs:{size:24,icon:"user",src:e.avatar}}),a("div",[a("div",[t._v(t._s(e.name))]),a("div",{staticClass:"muted"},[t._v(t._s(e.email))])])],1)])})),1)],1),a("a-form-item",{attrs:{label:"是否完成",colon:!1,labelCol:{span:6},wrapperCol:{span:18}}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["done",{initialValue:-1}],expression:"[\n                                          'done',\n                                           {initialValue: -1}\n\n                                          ]"}],attrs:{allowClear:"",placeholder:"请选择",optionFilterProp:"children"}},[a("a-select-option",{key:-1},[t._v("全部")]),a("a-select-option",{key:1},[t._v("是")]),a("a-select-option",{key:0},[t._v("否")])],1)],1),a("a-form-item",{attrs:{label:"优先级",colon:!1,labelCol:{span:6},wrapperCol:{span:18}}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["pri"],expression:"[\n                                          'pri',\n                                          ]"}],attrs:{mode:"multiple",showSearch:"",allowClear:"",placeholder:"请选择",optionFilterProp:"children"}},[a("a-select-option",{key:0},[t._v("普通")]),a("a-select-option",{key:1},[t._v("紧急")]),a("a-select-option",{key:2},[t._v("非常紧急")])],1)],1),a("a-form-item",{attrs:{label:"截止日期",colon:!1,labelCol:{span:6},wrapperCol:{span:18}}},[a("a-range-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["end_time"],expression:"[\n                                          'end_time',\n                                          ]"}],staticStyle:{width:"100%"},attrs:{allowClear:"",format:"YYYY-MM-DD"}})],1),a("a-form-item",{attrs:{label:"创建日期",colon:!1,labelCol:{span:6},wrapperCol:{span:18}}},[a("a-range-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["create_time"],expression:"[\n                                          'create_time',\n                                          ]"}],staticStyle:{width:"100%"},attrs:{allowClear:"",format:"YYYY-MM-DD"}})],1),a("a-form-item",{attrs:{label:"完成日期",colon:!1,labelCol:{span:6},wrapperCol:{span:18}}},[a("a-range-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["done_time"],expression:"[\n                                          'done_time',\n                                          ]"}],staticStyle:{width:"100%"},attrs:{allowClear:"",format:"YYYY-MM-DD"}})],1),a("a-form-item",{attrs:{label:"开始日期",colon:!1,labelCol:{span:6},wrapperCol:{span:18}}},[a("a-range-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["begin_time"],expression:"[\n                                          'begin_time',\n                                          ]"}],staticStyle:{width:"100%"},attrs:{allowClear:"",format:"YYYY-MM-DD"}})],1)],1),a("div",{staticClass:"footer m-t-md"},[a("a-button",{staticClass:"m-r",attrs:{type:"primary",size:"large"},on:{click:t.handleSubmit}},[t._v("搜索")]),a("a-button",{attrs:{size:"large"},on:{click:t.resetForm}},[t._v("重置")])],1)],1)])],1)},o=[],n=(a("c5f6"),a("2ef0"),a("c030")),i=a("9f09"),r=(a("97a8"),{name:"taskSearch",props:{projectCode:{type:[String,Number],default:function(){return""}}},data:function(){return{moment:moment,form:this.$form.createForm(this),loading:!1,projectMemberList:[],taskStageList:[]}},watch:{projectCode:function(){this.init()}},created:function(){this.init()},methods:{init:function(){this.projectCode&&(this.resetForm(),this.loading=!0,this.getProjectMemberList(),this.getTaskStageList())},getProjectMemberList:function(){var t=this;Object(n["c"])({projectCode:this.projectCode,pageSize:300}).then((function(e){t.projectMemberList=e.data.list,t.loading=!1}))},getTaskStageList:function(){var t=this;Object(i["a"])({projectCode:this.projectCode}).then((function(e){t.taskStageList=e.data,t.loading=!1}))},resetForm:function(){this.form.resetFields()},handleSubmit:function(){var t=this;this.form.validateFields((function(e,a){if(!e){var s=t.form.getFieldsValue();s.executor=JSON.stringify(s.executor),s.creator=JSON.stringify(s.creator),s.joiner=JSON.stringify(s.joiner),console.log(s),s.end_time&&s.end_time.length?s.endTime=JSON.stringify([moment(s.end_time[0]).format("YYYY-MM-DD"),moment(s.end_time[1]).format("YYYY-MM-DD")]):s.endTime=void 0,s.begin_time&&s.begin_time.length?s.beginTime=JSON.stringify([moment(s.begin_time[0]).format("YYYY-MM-DD"),moment(s.begin_time[1]).format("YYYY-MM-DD")]):s.beginTime=void 0,s.create_time&&s.create_time.length?s.createTime=JSON.stringify([moment(s.create_time[0]).format("YYYY-MM-DD"),moment(s.create_time[1]).format("YYYY-MM-DD")]):s.createTime=void 0,s.done_time&&s.done_time.length?s.doneTime=JSON.stringify([moment(s.done_time[0]).format("YYYY-MM-DD"),moment(s.done_time[1]).format("YYYY-MM-DD")]):s.doneTime=void 0,console.log(s),t.$emit("search",s)}}))}}}),c=r,l=(a("19f2"),a("2877")),d=Object(l["a"])(c,s,o,!1,null,null,null);e["default"]=d.exports},"24d2":function(t,e,a){"use strict";a.d(e,"a",(function(){return o})),a.d(e,"c",(function(){return n})),a.d(e,"b",(function(){return i}));var s=a("22b6");function o(t){return s["a"].post("project/project",t)}function n(t){return s["a"].post("project/project/selfList",t)}function i(t){return s["a"].post("project/project/read",{projectCode:t})}},"2f21":function(t,e,a){"use strict";var s=a("79e5");t.exports=function(t,e){return!!t&&s((function(){e?t.call(null,(function(){}),1):t.call(null)}))}},"51e2":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-tabs",{attrs:{tabPosition:"left",defaultActiveKey:"1",animated:!1},model:{value:t.tabKey,callback:function(e){t.tabKey=e},expression:"tabKey"}},[a("a-tab-pane",{key:"1"},[a("span",{attrs:{slot:"tab"},slot:"tab"},[a("a-icon",{attrs:{type:"check-square"}}),t._v("任务\n    ")],1)]),a("a-tab-pane",{key:"2"},[a("span",{attrs:{slot:"tab"},slot:"tab"},[a("a-icon",{attrs:{type:"link"}}),t._v("文件\n    ")],1)]),a("div",{staticClass:"config-content"},[a("vue-scroll",[a("div",{staticClass:"content-item"},[a("div",{staticClass:"infos"},[a("a-list",[t.showLoadingMore?a("div",{style:{textAlign:"center",marginTop:"12px",height:"32px",lineHeight:"32px"},attrs:{slot:"loadMore"},slot:"loadMore"},[t.loadingMore?a("a-spin"):a("a-button",{on:{click:t.onLoadMore}},[t._v("加载更多")])],1):t._e(),t._l(t.list,(function(e,s){return a("a-list-item",{key:s},[a("a-list-item-meta",[a("div",{attrs:{slot:"title"},slot:"title"},[a("router-link",{directives:[{name:"show",rawName:"v-show",value:"1"==t.tabKey,expression:"tabKey == '1'"}],staticClass:"text-default",attrs:{to:"/project/space/task/"+t.code+"/detail/"+e.code}},[t._v(t._s(e.name))]),a("a",{directives:[{name:"show",rawName:"v-show",value:"2"==t.tabKey,expression:"tabKey == '2'"}],staticClass:"text-default",attrs:{target:"_blank",href:e.file_url}},[t._v(t._s(e.fullName))])],1),a("div",{attrs:{slot:"description"},slot:"description"},[t._v(t._s(t.showTaskTime(e.deleted_time)))])]),a("a",{staticClass:"muted",attrs:{slot:"actions"},on:{click:function(a){return t.recoveryTask(e,s)}},slot:"actions"},[a("a-tooltip",{attrs:{title:"恢复内容"}},[a("a-icon",{attrs:{type:"undo"}})],1)],1),a("a",{staticClass:"muted",attrs:{slot:"actions"},on:{click:function(a){return t.deleteItem(e,s)}},slot:"actions"},[a("a-tooltip",{attrs:{title:"彻底删除"}},[a("a-icon",{attrs:{type:"delete"}})],1)],1)],1)}))],2)],1)])])],1)],1)},o=[],n=a("2f14"),i=a("ca8d"),r=a("0610"),c=a("1b80"),l=a("81fe"),d={name:"recycleBin",props:{code:{type:[String],default:function(){return""}}},mixins:[c["a"]],data:function(){return{loading:!1,tabKey:"1",project:{},list:[],showLoadingMore:!1,loadingMore:!1}},watch:{code:function(){this.init()},tabKey:function(t){this.init()}},created:function(){this.init()},methods:{init:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this;switch(t&&(this.list=[],this.pagination.page=1,this.pagination.pageSize=10,this.showLoadingMore=!1),this.requestData.deleted=1,this.requestData.projectCode=this.code,e.loading=!0,this.tabKey){case"1":e.getTasks();break;case"2":e.getFiles();break}},getTasks:function(){var t=this;Object(i["j"])(t.requestData).then((function(e){t.list=t.list.concat(e.data.list),t.pagination.total=e.data.total,t.showLoadingMore=t.pagination.total>t.list.length,t.loading=!1,t.loadingMore=!1}))},getFiles:function(){var t=this;Object(r["b"])(t.requestData).then((function(e){t.list=t.list.concat(e.data.list),t.pagination.total=e.data.total,t.showLoadingMore=t.pagination.total>t.list.length,t.loading=!1,t.loadingMore=!1}))},onLoadMore:function(){this.loadingMore=!0,this.pagination.page++,this.init(!1)},showTaskTime:function(t){return Object(l["b"])(t)},recoveryTask:function(t,e){var a=this;switch(this.tabKey){case"1":this.$confirm({title:"确定恢复内容？",content:"恢复后可在任务列表中查看",okText:"恢复内容",okType:"primary",cancelText:"再想想",onOk:function(){return Object(i["k"])(t.code).then((function(s){Object(n["a"])(s)&&(a.list.splice(e,1),a.$emit("update",t))})),Promise.resolve()}});break;case"2":this.$confirm({title:"确定恢复文件？",content:"恢复后可在我的文件中查看",okText:"恢复文件",okType:"primary",cancelText:"再想想",onOk:function(){return Object(r["c"])(t.code).then((function(s){Object(n["a"])(s)&&(a.list.splice(e,1),a.$emit("update",t))})),Promise.resolve()}});break}},deleteItem:function(t,e){var a=this;switch(this.tabKey){case"1":this.$confirm({title:"确定彻底删除任务？",content:"彻底删除任务后，该任务及其子任务将会被永久被删除。",okText:"彻底删除",okType:"danger",cancelText:"再想想",onOk:function(){return Object(i["e"])(t.code).then((function(s){Object(n["a"])(s)&&(a.list.splice(e,1),a.$emit("update",t))})),Promise.resolve()}});break;case"2":this.$confirm({title:"确认彻底删除该文件？",content:"彻底删除文件后，相关的关联资源将会失效。",okText:"彻底删除",okType:"danger",cancelText:"再想想",onOk:function(){return Object(r["a"])(t.code).then((function(s){Object(n["a"])(s)&&(a.list.splice(e,1),a.$emit("update",t))})),Promise.resolve()}});break}}}},u=d,m=(a("c9b7"),a("2877")),p=Object(m["a"])(u,s,o,!1,null,null,null);e["default"]=p.exports},"55dd":function(t,e,a){"use strict";var s=a("5ca1"),o=a("d8e8"),n=a("4bf8"),i=a("79e5"),r=[].sort,c=[1,2,3];s(s.P+s.F*(i((function(){c.sort(void 0)}))||!i((function(){c.sort(null)}))||!a("2f21")(r)),"Array",{sort:function(t){return void 0===t?r.call(n(this)):r.call(n(this),o(t))}})},"64a8":function(t,e,a){"use strict";var s=a("c101"),o=a.n(s);o.a},7934:function(t,e,a){"use strict";var s=a("b845"),o=a.n(s);o.a},"81fe":function(t,e,a){"use strict";a.d(e,"c",(function(){return s})),a.d(e,"b",(function(){return o})),a.d(e,"a",(function(){return n})),a.d(e,"d",(function(){return i}));a("3b2b"),a("a481");var s=function(t,e){e||(e=moment());var a=moment(e).diff(moment(t),"hours");if(a<=1)return moment(t).fromNow();moment(e).get("date"),moment(t).get("date");var s=moment(t).format("H:mm"),o=moment(t).format("YYYY-MM-DD"),n=moment().weekday(0).format("YYYY-MM-DD"),i=moment().weekday(6).format("YYYY-MM-DD"),r="";return r=o<n?"[上周]dd "+s:o>i?"[下周]dd "+s:"[周]dd "+s,moment(t).calendar(null,{sameDay:"[今天 ]"+moment(t).format("H:mm"),nextDay:"[明天 ]"+s,nextWeek:r,lastDay:"[昨天 ]"+s,lastWeek:r,sameElse:"M月D日 H:mm"})},o=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=moment(t).format("H:mm");e||(a="");var s=moment(t).format("YYYY-MM-DD"),o=moment().weekday(0).format("YYYY-MM-DD"),n=moment().weekday(6).format("YYYY-MM-DD"),i="";return i=s<o?"[上周]dd "+a:s>n?"[下周]dd "+a:"[周]dd "+a,moment(t).calendar(null,{sameDay:"[今天 ]"+moment(t).format("H:mm"),nextDay:"[明天 ]"+a,nextWeek:i,lastDay:"[昨天 ]"+a,lastWeek:i,sameElse:"M月D日 H:mm"})},n=function(t,e){return!e&&t?o(t)+" 开始":t?o(t)+" - "+o(e):o(e)+" 截止"},i=function(t){var e="";void 0==t&&(t=new Date);var a=t.getHours();return a>=0&&a<=4&&(e="深夜了，注意身体，"),a>=4&&a<7&&(e="清晨好， "),a>=7&&a<12&&(e="早安，"),a>=12&&a<=13&&(e="午饭时间到了，"),a>=13&&a<=17&&(e="下午好，"),a>=17&&a<=18&&(e="进入傍晚了，"),a>=18&&a<=20&&(e="吃过晚饭了吗，"),a>=20&&a<=24&&(e="在加班吗？辛苦了，"),e}},a35e:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"project-space-task",class:t.project.task_board_theme},[a("div",{staticClass:"project-navigation"},[a("div",{staticClass:"project-nav-header"},[a("a-breadcrumb",[a("a-breadcrumb-item",[a("a",{on:{click:t.toHome}},[a("a-icon",{attrs:{type:"home"}}),t._v("首页\n          ")],1)]),a("a-breadcrumb-item",[a("project-select",{staticClass:"nav-title",staticStyle:{display:"inline-block"},attrs:{code:t.code}}),a("span",{staticClass:"actions"},[a("a-tooltip",{attrs:{mouseEnterDelay:.3,title:t.project.collected?"取消收藏":"加入收藏"},on:{click:t.collectProject}},[a("a-icon",{directives:[{name:"show",rawName:"v-show",value:!t.project.collected,expression:"!project.collected"}],staticStyle:{color:"grey"},attrs:{type:"star",theme:"filled"}}),a("a-icon",{directives:[{name:"show",rawName:"v-show",value:t.project.collected,expression:"project.collected"}],staticStyle:{color:"#ffaf38"},attrs:{type:"star",theme:"filled"}})],1)],1),0===t.project.private?a("span",{staticClass:"label label-normal"},[a("a-icon",{attrs:{type:"global"}}),t._v("公开\n          ")],1):t._e()],1)],1)],1),a("section",{staticClass:"nav-body"},[a("ul",{staticClass:"nav-wrapper nav nav-underscore pull-left"},[t._m(0),a("li",{},[a("a",{staticClass:"app",attrs:{"data-app":"works"},on:{click:function(e){return t.$router.push("/project/space/files/"+t.code)}}},[t._v("文件")])]),a("li",{},[a("a",{staticClass:"app",attrs:{"data-app":"build"},on:{click:function(e){return t.$router.push("/project/space/overview/"+t.code)}}},[t._v("概览")])]),a("li",{},[a("a",{staticClass:"app",attrs:{"data-app":"build"},on:{click:function(e){return t.$router.push("/project/space/features/"+t.code)}}},[t._v("版本")])])])]),a("div",{staticClass:"project-nav-footer"},[a("a",{staticClass:"footer-item",on:{click:function(e){return t.visibleDraw("taskSearch")}}},[a("a-icon",{attrs:{type:"search"}}),a("span",[t._v("筛选")])],1),a("a",{staticClass:"footer-item",class:{active:"member"==t.slideMenuKey},on:{click:function(e){return t.visibleDraw("member")}}},[a("a-icon",{attrs:{type:"user"}}),a("span",[t._v(t._s(t.projectMembers.length))])],1),a("a",{staticClass:"footer-item",class:{active:"config"==t.slideMenuKey},on:{click:function(e){return t.visibleDraw("config")}}},[a("a-icon",{attrs:{type:"menu"}}),a("span",[t._v("菜单")])],1)])]),a("wrapper-content",{attrs:{showHeader:!1}},[a("draggable",{staticClass:"board-scrum-stages",attrs:{options:{group:"stages",filter:".undraggables",handle:".ui-sortable-handle",ghostClass:"stage-ghost",animation:200,forceFallback:!1},id:"board-scrum-stages",move:t.stageMove},on:{update:t.stageSort},model:{value:t.taskStages,callback:function(e){t.taskStages=e},expression:"taskStages"}},[t._l(t.taskStages,(function(e,s){return a("div",{key:s,staticClass:"scrum-stage",class:{"fixed-creator":1==e.fixedCreator},attrs:{id:e.code}},[a("header",{directives:[{name:"show",rawName:"v-show",value:!e.tasksLoading,expression:"!stage.tasksLoading"}],staticClass:"scrum-stage-header ui-sortable-handle"},[a("div",{staticClass:"stage-name hinted"},[t._v("\n            "+t._s(e.name)+"\n            "),e.tasks.length>0?a("span",{staticClass:"task-count"},[t._v("· "+t._s(e.tasks.length))]):t._e()]),a("div",{staticClass:"stage-menu-toggler popover"},[a("a-dropdown",{attrs:{trigger:["click"],placement:"bottomCenter"}},[a("a-tooltip",{attrs:{placement:"top"}},[a("template",{slot:"title"},[a("span",[t._v("编辑任务列表")])]),a("a",{staticClass:"menu-toggler-title",attrs:{href:"javascript:void(0)"}},[a("a-icon",{staticStyle:{"font-size":"18px"},attrs:{type:"ellipsis"}})],1)],2),a("a-menu",{attrs:{slot:"overlay",selectable:!1},on:{click:t.doStage},slot:"overlay"},[a("a-menu-item",{key:"editStage_"+e.code+"_"+s},[a("a-icon",{attrs:{type:"edit"}}),t._v("编辑列表\n                ")],1),a("a-menu-item",{key:"setExecutor_"+e.code+"_"+s},[a("a-icon",{attrs:{size:"14",type:"user"}}),t._v("设置本列所有任务执行者\n                ")],1),a("a-menu-item",{key:"recycleBatch_"+e.code+"_"+s},[a("a-icon",{attrs:{size:"14",type:"delete"}}),t._v("本列所有任务移到回收站\n                ")],1),a("a-menu-item",{key:"delStage_"+e.code+"_"+s},[a("a-icon",{attrs:{size:"14",type:"delete"}}),t._v("删除列表\n                ")],1)],1)],1)],1)]),a("div",{staticClass:"scrum-stage-wrap ui-sortable",class:{"hidden-creator-bottom":e.showTaskCard}},[a("vue-scroll",{ref:s+"-stage",refInFor:!0,attrs:{ops:t.scrollOps},on:{"handle-resize":function(e){return t.handleResize(e,s)}}},[a("section",{staticClass:"scrum-stage-content thin-scroll",attrs:{id:e.code,"task-type-index":s}},[a("a-spin",{attrs:{wrapperClassName:"tasks-loading",spinning:e.tasksLoading}},[a("draggable",{staticClass:"scrum-stage-tasks",attrs:{options:{group:"task",ghostClass:"task-ghost",dragClass:"task-drag",fallbackClass:"task-drag",forceFallback:!1}},on:{end:t.taskSort},model:{value:e.unDoneTasks,callback:function(a){t.$set(e,"unDoneTasks",a)},expression:"stage.unDoneTasks"}},[t._l(e.unDoneTasks,(function(e,o){return[!e.done&&e.canRead?a("div",{key:e.code,staticClass:"task task-card ui-sortable-handle",class:t.showTaskPri(e.pri),attrs:{index:o,id:e.code},on:{click:function(a){return a.stopPropagation(),t.taskDetail(e.code,s)}}},[a("div",{staticClass:"task-priority bg-priority-0"}),a("a-tooltip",{attrs:{placement:s>0?"top":"right"}},[a("template",{slot:"title"},[e.hasUnDone?a("span",{staticStyle:{"font-size":"12px"}},[t._v("子任务尚未全部完成，无法完成父任务")]):t._e()]),a("div",{staticClass:"check-box-wrapper",on:{click:function(a){return a.stopPropagation(),t.taskDone(e.code,s,o,1)}}},[a("a-icon",{staticClass:"check-box",class:{disabled:e.hasUnDone},style:{fontSize:"16px"},attrs:{type:"border"}})],1)],2),a("div",{staticClass:"task-content-set open-detail"},[a("div",{staticClass:"task-content-wrapper"},[a("div",{staticClass:"task-content"},[t._v(t._s(e.name))]),e.executor&&e.executor.avatar?a("a-tooltip",{attrs:{placement:"top"}},[a("template",{slot:"title"},[a("span",[t._v(t._s(e.executor.name))])]),a("img",{staticClass:"avatar img-circle img-24 hinted",attrs:{src:e.executor.avatar,title:e.executor.name}})],2):t._e()],1),a("div",{staticClass:"task-info-wrapper clearfix"},[a("div",{staticClass:"task-infos"},[e.end_time?a("span",{staticClass:"label",class:t.showTimeLabel(e.end_time)},[a("span",{attrs:{title:e.end_time}},[t._v("\n                                "+t._s(t.showTaskTime(e.begin_time,e.end_time))+"\n                              ")])]):t._e(),e.description?a("span",{staticClass:"icon-wrapper muted"},[a("a-icon",{attrs:{type:"file-text"}})],1):t._e(),e.hasSource?a("span",{staticClass:"icon-wrapper muted"},[a("a-icon",{attrs:{type:"link"}})],1):t._e(),e.hasComment?a("span",{staticClass:"icon-wrapper muted"},[a("a-icon",{attrs:{type:"message"}})],1):t._e(),e.childCount[0]>0?a("span",{staticClass:"icon-wrapper muted"},[a("a-icon",{attrs:{type:"bars"}}),a("span",[t._v("\n                                "+t._s(e.childCount[1])+"/"+t._s(e.childCount[0])+"\n                              ")])],1):t._e(),t._l(e.tags,(function(e){return a("span",{key:e.code,staticClass:"tag muted"},[a("a-badge",{class:"badge-"+e.tag.color,attrs:{status:"success"}}),t._v("\n                              "+t._s(e.tag.name)+"\n                            ")],1)})),e.execute_state>0?a("span",{class:"icon-wrapper text text-"+e.task_execute.color},[t._v(t._s(e.task_execute_name))]):t._e(),e.like?a("span",{staticClass:"icon-wrapper muted"},[a("a-icon",{attrs:{type:"like"}}),a("span",[t._v(t._s(e.like))])],1):t._e()],2)]),t.project.prefix&&t.project.open_prefix?a("footer",{staticClass:"task-info-footer"},[a("span",{staticClass:"task-id-number"},[t._v(t._s(t.project.prefix)+"-"+t._s(e.id_num))])]):t._e()])],1):t._e()]}))],2),a("div",{directives:[{name:"show",rawName:"v-show",value:e.showTaskCard,expression:"stage.showTaskCard"}],staticClass:"task-creator-wrap card",attrs:{id:"card"+s}},[a("form",{staticClass:"task-creator"},[a("a-input",{ref:"inputTaskName"+s,refInFor:!0,staticClass:"task-content-input",attrs:{type:"textarea",rows:3,placeholder:"任务内容"},on:{keyup:function(a){return!a.type.indexOf("key")&&t._k(a.keyCode,"enter",13,a.key,"Enter")?null:t.createTask(e.code,s)}},model:{value:t.task.name,callback:function(e){t.$set(t.task,"name",e)},expression:"task.name"}}),a("div",{staticClass:"handler-wrap"},[a("a-dropdown",{attrs:{trigger:["click"]}},[a("a",{staticClass:"executor-handler"},[a("img",{staticClass:"avatar img-circle img-24 hinted",attrs:{src:t.defaultExecutor.avatar}}),a("span",{staticClass:"creator-handler-text name"},[t._v("\n                            "+t._s(t.defaultExecutor.name)+"\n                          ")])]),a("a-menu",{staticClass:"executor-handler-menu",attrs:{slot:"overlay"},on:{click:t.selectExecutor},slot:"overlay"},t._l(t.projectMembers,(function(e,s){return a("a-menu-item",{key:s},[a("img",{staticClass:"avatar img-circle img-32 pull-left m-r-sm",attrs:{src:e.avatar}}),a("span",{staticClass:"muted",staticStyle:{"line-height":"25px"}},[t._v("\n                              "+t._s(e.name)+"\n                            ")]),e.code==t.defaultExecutor.code?a("a-icon",{staticClass:"muted",attrs:{type:"check"}}):t._e()],1)})),1)],1)],1),a("div",{staticClass:"submit-set"},[a("a-button",{staticClass:"middle-btn",attrs:{type:"default",size:"large"},on:{click:function(e){return e.stopPropagation(),t.showTaskCard(s,!1)}}},[t._v("取消")]),a("a-button",{staticClass:"middle-btn",class:{"disabled-btn":!t.task.name},attrs:{loading:t.createTaskLoading,disabled:!t.task.name,type:"primary",size:"large"},on:{click:function(a){return a.stopPropagation(),t.createTask(e.code,s)}}},[t._v("创建")])],1)],1)]),a("draggable",{staticClass:"scrum-stage-tasks-done",attrs:{options:{group:"task-done",ghostClass:"task-ghost",dragClass:"task-drag",fallbackClass:"task-drag",forceFallback:!1}},on:{end:t.taskSort},model:{value:e.doneTasks,callback:function(a){t.$set(e,"doneTasks",a)},expression:"stage.doneTasks"}},[t._l(e.doneTasks,(function(e,o){return[e.canRead?a("div",{key:e.code,staticClass:"task done task-card ui-sortable-handle",attrs:{index:o,id:e.code},on:{click:function(a){return a.stopPropagation(),t.taskDetail(e.code,s)}}},[a("div",{staticClass:"task-priority bg-priority-0"}),a("span",{staticClass:"check-box-wrapper",on:{click:function(a){return a.stopPropagation(),t.taskDone(e.code,s,o,0)}}},[a("a-icon",{staticClass:"check-box",class:{disabled:e.hasUnDone},style:{fontSize:"16px"},attrs:{type:"check-square"}})],1),a("div",{staticClass:"task-content-set open-detail"},[a("div",{staticClass:"task-content-wrapper"},[a("div",{staticClass:"task-content"},[t._v(t._s(e.name))]),e.executor&&e.executor.avatar?a("a-tooltip",{attrs:{placement:"top"}},[a("template",{slot:"title"},[a("span",[t._v(t._s(e.executor.name))])]),e.executor&&e.executor.avatar?a("img",{staticClass:"avatar img-circle img-24 hinted",attrs:{src:e.executor.avatar,title:e.executor.name}}):t._e()],2):t._e()],1),a("div",{staticClass:"task-info-wrapper clearfix"},[a("div",{staticClass:"task-infos"},t._l(e.task_tag_item_list,(function(e,s){return a("span",{key:e.code,staticClass:"tag muted",class:"tag-color-"+e.color},[t._v(t._s(e.name))])})),0)])])]):t._e()]}))],2),a("div",{directives:[{name:"show",rawName:"v-show",value:e.canNotReadCount,expression:"stage.canNotReadCount"}],staticClass:"scrum-stage-tasks-done"},[a("li",{staticClass:"task muted",staticStyle:{margin:"0 10px 8px"}},[a("span",[a("a-icon",{attrs:{type:"lock"}}),t._v("\n                      有\n                      "+t._s(e.canNotReadCount)+"\n                      个任务被隐藏（因为设置了仅参与者可见）\n                    ")],1)])]),e.showTaskCard?t._e():a("div",{staticClass:"task-creator-handler-wrap",on:{click:function(e){return e.stopPropagation(),t.showTaskCard(s)}}},[a("a",{staticClass:"task-creator-handler link-add-handler"},[a("a-icon",{staticStyle:{"padding-right":"6px"},attrs:{type:"plus-circle"}}),t._v("添加任务\n                  ")],1)])],1)],1)])],1)])})),a("div",{staticClass:"scrum-stage undraggable create-stage"},[a("header",{staticClass:"scrum-stage-header"},[a("div",{staticClass:"stage-name hinted",staticStyle:{width:"100%"}},[a("a",{directives:[{name:"show",rawName:"v-show",value:!t.showCreateStage,expression:"!showCreateStage"}],staticClass:"muted",on:{click:t.showInputStrageName}},[a("a-icon",{attrs:{type:"plus"}}),a("span",{staticClass:"m-l-xs"},[t._v("新建任务列表")])],1),a("div",{directives:[{name:"show",rawName:"v-show",value:t.showCreateStage,expression:"showCreateStage"}]},[a("div",[a("a-input",{ref:"inputStageName",attrs:{placeholder:"新建任务列表...","auto-focus":""},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.creteStage(e)}},model:{value:t.stageName,callback:function(e){t.stageName=e},expression:"stageName"}})],1),a("div",{staticClass:"submit-set create-stage-footer"},[a("a",{staticClass:"cancel-text muted",attrs:{type:"text"},on:{click:function(e){t.showCreateStage=!t.showCreateStage}}},[t._v("取消")]),a("a-button",{staticClass:"middle-btn",attrs:{type:"primary"},on:{click:t.creteStage}},[t._v("保存")])],1)])])])])],2),a("router-view")],1),a("a-modal",{attrs:{width:360,title:t.stageModal.modalTitle,bodyStyle:{paddingBottom:"1px"},footer:null},model:{value:t.stageModal.modalStatus,callback:function(e){t.$set(t.stageModal,"modalStatus",e)},expression:"stageModal.modalStatus"}},[a("a-form",{attrs:{form:t.stageModal.form},on:{submit:function(e){return e.preventDefault(),t.editStage(e)}}},[a("a-form-item",[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,message:"请输入列表标题"}]}],expression:"[\n            'name',\n            {rules: [{required: true, message: '请输入列表标题'}]},\n          ]"}],ref:"inputStageTitle",attrs:{placeholder:"列表标题"}})],1),a("a-form-item",[a("div",{staticClass:"action-btn pull-right"},[a("a",{staticClass:"cancel-text muted",attrs:{type:"text"},on:{click:function(e){t.stageModal.modalStatus=!1}}},[t._v("取消")]),a("a-button",{staticClass:"middle-btn",attrs:{type:"primary",htmlType:"submit"}},[t._v("保存")])],1)])],1)],1),a("a-drawer",{attrs:{wrapClassName:"info-drawer",title:"项目成员",width:"350",placement:"right",visible:t.inviteMemberDraw.visible},on:{close:function(e){t.inviteMemberDraw.visible=!1}}},[a("div",{staticClass:"search-content"},[a("a-input",{attrs:{size:"large",placeholder:"输入昵称或邮箱查找"},model:{value:t.inviteMemberDraw.keyword,callback:function(e){t.$set(t.inviteMemberDraw,"keyword",e)},expression:"inviteMemberDraw.keyword"}},[a("a-icon",{attrs:{slot:"prefix",type:"search"},slot:"prefix"})],1)],1),a("div",{staticClass:"member-list"},[a("div",{staticClass:"member-list-item ant-list-item header-action"},[a("div",{staticClass:"ant-list-item-meta",on:{click:function(e){t.showInviteMember=!0}}},[a("div",{staticClass:"ant-list-item-meta-avatar"},[a("a-avatar",{attrs:{icon:"plus"}})],1),a("div",{staticClass:"ant-list-item-meta-content"},[a("h4",{staticClass:"ant-list-item-meta-title"},[a("span",[t._v("邀请新成员")])])])])]),a("a-list",{attrs:{itemLayout:"horizontal",loading:t.inviteMemberDraw.searching,dataSource:t.projectMembers,locale:{emptyText:t.inviteMemberDraw.keyword&&t.inviteMemberDraw.keyword.length>1?"没有搜索到相关成员":""}},scopedSlots:t._u([{key:"renderItem",fn:function(e,s){return a("a-list-item",{staticClass:"member-list-item"},[e.is_owner?t._e():a("span",{attrs:{slot:"actions"},slot:"actions"},[a("a",{staticClass:"muted",on:{click:function(a){return t.removeMember(e,s)}}},[a("a-icon",{attrs:{type:"user-delete"}}),t._v("移除\n            ")],1)]),a("a-list-item-meta",{attrs:{description:e.email}},[a("span",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.name))]),a("a-avatar",{attrs:{slot:"avatar",icon:"user",src:e.avatar},slot:"avatar"})],1)],1)}}])})],1)]),a("a-drawer",{attrs:{wrapClassName:"info-drawer",title:"项目设置",width:"350",placement:"right",visible:t.configDraw.visible},on:{close:function(e){t.configDraw.visible=!1}}},[a("div",{staticClass:"config-wrapper"},[a("ul",{staticClass:"config-menus"},[a("li",{staticClass:"menu-item"},[a("a",{on:{click:function(e){t.projectModal.modalStatus=!0}}},[a("a-icon",{attrs:{type:"setting"}}),t._v("项目设置\n          ")],1)]),a("li",{staticClass:"menu-item"},[a("a",{on:{click:function(e){t.taskTagModal.modalStatus=!0}}},[a("a-icon",{attrs:{type:"tags"}}),t._v("标签\n          ")],1)]),a("li",{staticClass:"menu-item"},[a("a",{on:{click:function(e){t.recycleModal.modalStatus=!0}}},[a("a-icon",{attrs:{type:"delete"}}),t._v("查看回收站\n          ")],1)]),a("li",{staticClass:"menu-item"},[a("a",{attrs:{href:t.downLoadUrl,target:"_blank"}},[a("a-icon",{attrs:{type:"copy"}}),t._v("下载导入任务模板\n          ")],1)]),a("li",{staticClass:"menu-item"},[a("a-upload",{attrs:{name:"file",showUploadList:!1,action:t.uploadAction,beforeUpload:t.beforeUpload,data:{projectCode:t.code},headers:t.headers},on:{change:t.handleChange}},[a("a",{staticClass:"text-default",attrs:{loading:t.uploadLoading,disabled:t.uploadLoading}},[a("a-icon",{directives:[{name:"show",rawName:"v-show",value:!t.uploadLoading,expression:"!uploadLoading"}],attrs:{type:"upload"}}),t._v("上传文件导入任务\n            ")],1)])],1),a("li",{staticClass:"menu-item"},[a("a",[a("a-icon",{attrs:{type:"logout"}}),t._v("导出任务 *\n          ")],1)]),a("li",{staticClass:"menu-item"},[a("a",[a("a-icon",{attrs:{type:"copy"}}),t._v("复制项目 *\n          ")],1)]),a("li",{staticClass:"menu-item"},[a("a",[a("a-icon",{attrs:{type:"block"}}),t._v("保存为项目模板 *\n          ")],1)])])])]),a("a-modal",{staticClass:"project-config-modal",attrs:{destroyOnClose:"",width:800,title:t.projectModal.modalTitle,footer:null},model:{value:t.projectModal.modalStatus,callback:function(e){t.$set(t.projectModal,"modalStatus",e)},expression:"projectModal.modalStatus"}},[a("project-config",{attrs:{code:t.code},on:{update:t.updateProject}})],1),a("a-modal",{staticClass:"recycle-bin-modal",attrs:{width:800,title:t.recycleModal.modalTitle,footer:null},model:{value:t.recycleModal.modalStatus,callback:function(e){t.$set(t.recycleModal,"modalStatus",e)},expression:"recycleModal.modalStatus"}},[t.recycleModal.modalStatus?a("recycle-bin",{attrs:{code:t.code},on:{update:t.init}}):t._e()],1),a("a-modal",{staticClass:"task-tag-modal",attrs:{width:800,title:t.taskTagModal.modalTitle,footer:null},model:{value:t.taskTagModal.modalStatus,callback:function(e){t.$set(t.taskTagModal,"modalStatus",e)},expression:"taskTagModal.modalStatus"}},[t.taskTagModal.modalStatus?a("task-tag",{attrs:{code:t.code},on:{update:t.init}}):t._e()],1),a("a-modal",{staticClass:"invite-project-member",attrs:{width:360,title:t.projectMemberModal.modalTitle,footer:null},model:{value:t.projectMemberModal.modalStatus,callback:function(e){t.$set(t.projectMemberModal,"modalStatus",e)},expression:"projectMemberModal.modalStatus"}},[a("div",{staticClass:"member-list"},[a("a-list",{staticClass:"project-list",attrs:{itemLayout:"horizontal",loading:t.loading,dataSource:t.projectMembers},scopedSlots:t._u([{key:"renderItem",fn:function(e){return a("a-list-item",{},[a("span",{attrs:{slot:"actions"},slot:"actions"},[a("a-button",{attrs:{size:"small",type:"dashed",icon:"user-add"},on:{click:function(a){return t.setExecutor(e)}}},[t._v("设置")])],1),a("a-list-item-meta",{attrs:{description:e.email}},[a("span",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.name))]),a("a-avatar",{attrs:{slot:"avatar",icon:"user",src:e.avatar},slot:"avatar"})],1)],1)}}])})],1)]),a("a-drawer",{attrs:{wrapClassName:"info-drawer task-search",title:"任务筛选",width:"350",placement:"right",visible:t.taskSearch.visible},on:{close:function(e){t.taskSearch.visible=!1}}},[a("task-search",{attrs:{"project-code":t.code},on:{search:t.taskSearchAction}})],1),t.showInviteMember?a("invite-project-member",{attrs:{"project-code":t.code},model:{value:t.showInviteMember,callback:function(e){t.showInviteMember=e},expression:"showInviteMember"}}):t._e()],1)},o=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("li",{staticClass:"actives"},[a("a",{staticClass:"app",attrs:{"data-app":"tasks"}},[t._v("任务")])])}],n=(a("8e6e"),a("456d"),a("28a5"),a("55dd"),a("ac6a"),a("7f7f"),a("bd86")),i=a("5880"),r=a("2ef0"),c=a.n(r),l=a("310e"),d=a.n(l),u=a("f8c7"),m=a("d3a1"),p=a("58bf"),f=a("51e2"),h=a("e3cc"),g=a("1d80"),v=a("9f09"),k=a("6be7"),b=a("c030"),C=a("ca8d"),y=a("2f14"),w=a("81fe"),j=a("e55b"),_=a("97a8");function M(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,s)}return a}function x(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?M(Object(a),!0).forEach((function(e){Object(n["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):M(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var S={name:"project-space-task",components:{RecycleBin:f["default"],TaskTag:h["default"],draggable:d.a,projectSelect:u["default"],TaskSearch:g["default"],inviteProjectMember:m["default"],projectConfig:p["default"]},data:function(){return{code:this.$route.params.code,loading:!0,project:{task_board_theme:"simple"},stageName:"",task:{},taskStages:[],defaultExecutor:{},projectMembers:[],projectMembersCopy:[],createTaskLoading:!1,showCreateStage:!1,preCode:"",nextCode:"",taskSearchParams:{},stageKeys:[],stageModal:{form:this.$form.createForm(this),stageCode:"",stageIndex:0,modalStatus:!1,confirmLoading:!1,modalTitle:"编辑列表"},slideMenuKey:"",showInviteMember:!1,inviteMemberDraw:{visible:!1,keyword:"",searching:!1,list:[]},configDraw:{visible:!1},taskSearch:{visible:!1},downLoadUrl:Object(y["h"])("project/task/_downloadTemplate"),uploadLoading:!1,uploadAction:Object(y["c"])("project/task/uploadFile"),projectModal:{modalStatus:!1,modalTitle:"项目设置"},recycleModal:{modalStatus:!1,modalTitle:"查看回收站"},taskTagModal:{modalStatus:!1,modalTitle:"任务标签"},projectMemberModal:{loading:!1,currentStageIndex:0,modalStatus:!1,modalTitle:"设置任务执行者"}}},computed:x({},Object(i["mapState"])({userInfo:function(t){return t.userInfo},viewRefresh:function(t){return t.common.viewRefresh},socketAction:function(t){return t.socketAction}}),{headers:function(){return Object(y["d"])()},scrollOps:function(){return{rail:{background:"#e5e5e5",opacity:1},bar:{keepShow:!0}}}}),watch:{$route:function(t,e){var a=this;if(this.code!=t.params.code&&(this.code=t.params.code,this.defaultExecutor=this.userInfo,this.getProject(),this.getProjectMembers(),this.init()),"taskdetail"==e.name){var s=e.query.from;if(void 0!=s){var o=this.taskSearchParams,n=Object.assign({stageCode:this.taskStages[s].code},o);Object(v["g"])(n).then((function(t){a.taskStages[s].tasksLoading=!1,a.taskStages[s].tasks=t.data;var e=a.taskStages[s].doneTasks=[],o=a.taskStages[s].unDoneTasks=[];t.data.forEach((function(t){t.done?e.push(t):o.push(t)}))}))}}},socketAction:function(t){if("organization:task"===t.action){var e=t.data.data;e.projectCode==this.code&&this.getTaskStages(!1)}},viewRefresh:function(){console.log("viewRefresh")},inviteMemberDraw:{handler:function(t){t.visible?this.slideMenuKey="member":this.slideMenuKey=!1,t.keyword&&this.searchInviteMember()},deep:!0},configDraw:{handler:function(t){t.visible?this.slideMenuKey="config":this.slideMenuKey=!1},deep:!0},showInviteMember:function(t){t||this.getProjectMembers()}},created:function(){this.defaultExecutor=this.userInfo,this.getProject(),this.getProjectMembers(),this.init()},methods:{init:function(){this.getTaskStages()},getProject:function(){var t=this;this.loading=!0,Object(k["h"])(this.code).then((function(e){t.loading=!1,t.project=e.data}))},getProjectMembers:function(){var t=this;Object(b["c"])({projectCode:this.code,pageSize:100}).then((function(e){t.projectMembers=e.data.list,t.projectMembersCopy=e.data.list}))},getTaskStages:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],a=this;Object(v["d"])({projectCode:this.code,pageSize:30}).then((function(s){var o=[];if(e?t.taskStages=o=s.data.list:s.data.list.forEach((function(t){t.tasksLoading=!1,o.push(t)})),o){var n=a.taskSearchParams,i={};o.forEach((function(t,s){i={stageCode:t.code},i=Object.assign(i,n),Object(v["g"])(i).then((function(o){var n=0;o.data.forEach((function(e){e.canRead||n++,e.done?t.doneTasks.push(e):t.unDoneTasks.push(e)})),t.canNotReadCount=n,t.tasksLoading=!1,t.tasks=o.data,e||a.$set(a.taskStages,s,t)}))}))}}))},filterTask:function(t,e){return t.filter((function(t){return t.done==e}))},taskSearchAction:function(t){console.log(t),this.taskSearchParams=t,this.getTaskStages()},showTaskCard:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.taskStages.forEach((function(t){t.showTaskCard=!1})),!1===e)return!1;this.taskStages[e].showTaskCard=a,this.$nextTick((function(){t.$refs[e+"-stage"][0].scrollIntoView("#card"+e),t.$refs["inputTaskName".concat(e)][0].focus()}))},selectExecutor:function(t){var e=t.key;this.defaultExecutor=this.projectMembers[e]},createTask:function(t,e){if(!this.task.name)return this.$message.warning("任务内容不能为空",2),!1;this.task.stage_code=t,this.task.project_code=this.code,this.task.assign_to=this.defaultExecutor.code,this.confirmCreateTask(e)},confirmCreateTask:function(t){var e=this;if(e.createTaskLoading)return e.$message.warning("正在添加任务，请稍后...",2),!1;setTimeout((function(){!0===e.createTaskLoading&&e.$message.loading({content:"正在添加任务，请稍后...",duration:5})}),2e3),e.createTaskLoading=!0,Object(C["m"])(e.task).then((function(a){e.createTaskLoading=!1;var s=Object(y["a"])(a);if(s){e.$message.destroy();var o=e.taskStages[t];o.tasks.push(a.data),e.taskStages[t].unDoneTasks.push(a.data),e.task={}}})).catch((function(){e.createTaskLoading=!1}))},taskDone:function(t,e,a,s){var o=this,n=null,i=this.taskStages[e].unDoneTasks,r=this.taskStages[e].doneTasks;if(n=s?i[a]:r[a],n.hasUnDone)return!1;n.done=s,s?(i.splice(a,1),r.push(n),r=r.sort((function(t,e){return t.sort===e.sort?t.id_num-e.id_num:t.sort-e.sort}))):(r.splice(a,1),i.push(n),i=i.sort((function(t,e){return t.sort===e.sort?t.id_num-e.id_num:t.sort-e.sort}))),Object(C["s"])(t,s).then((function(t){var e=Object(y["a"])(t);if(!e)return!1;o.getTaskStages(!1)}))},showInputStrageName:function(){var t=this;this.showCreateStage=!this.showCreateStage,this.$nextTick((function(){t.$refs.inputStageName.focus()}))},doStage:function(t){var e=this,a=this,s=t.key.split("_"),o=s[s.length-2],n=s[s.length-1],i=s[0];switch(i){case"editStage":this.stageModal.stageCode=o,this.stageModal.stageIndex=n,this.$nextTick((function(){e.stageModal.form.setFieldsValue({name:e.taskStages[n].name}),e.$refs.inputStageTitle.focus()})),this.stageModal.modalStatus=!0;break;case"recycleBatch":this.$confirm({title:"移到回收站",content:"您确定要把列表下的所有任务移到回收站吗？",okText:"移到回收站",okType:"danger",cancelText:"再想想",onOk:function(){return a.taskStages[n].tasks=[],a.$set(a.taskStages[n],"doneTasks",[]),Object(C["l"])({stageCode:o}).then((function(t){var e=Object(y["a"])(t);if(!e)return!1;a.$set(a.taskStages[n],"doneTasks",[]),a.$set(a.taskStages[n],"unDoneTasks",[])})),Promise.resolve()}});break;case"setEndTime":this.set_type_endTime_modal=!0;break;case"setExecutor":this.projectMemberModal.currentStageIndex=n,this.projectMemberModal.modalStatus=!0;break;case"delStage":if(this.taskStages[n].tasks.length>0)return this.$warning({title:"删除列表",content:"请先清空此列表上的任务，然后再删除这个列表",okText:"确定"}),!1;this.$confirm({title:"删除列表",content:"您确定要永远删除这个列表吗？",okText:"删除",okType:"danger",cancelText:"再想想",onOk:function(){return Object(v["b"])(o),a.taskStages.splice(n,1),Promise.resolve()}});break}},creteStage:function(){var t=this;if(!this.stageName)return this.$message.warning("请输入列表名称",2),!1;Object(v["e"])({name:this.stageName,projectCode:this.code}).then((function(e){var a=Object(y["a"])(e);if(!a)return!1;var s=e.data;t.taskStages.push(s),t.stageName="",t.$nextTick((function(){document.getElementById("board-scrum-stages").scrollLeft=1e4}))}))},editStage:function(){var t=this,e=this.stageModal.form.getFieldsValue();if(!e.name)return this.$message.warning("请输入列表名称",2),!1;Object(v["c"])({name:e.name,stageCode:this.stageModal.stageCode}).then((function(a){var s=Object(y["a"])(a);if(!s)return!1;t.taskStages[t.stageModal.stageIndex].name=e.name,t.stageModal.modalStatus=!1}))},setExecutor:function(t){var e=this,a=this.taskStages[this.projectMemberModal.currentStageIndex],s=[];a.tasks.forEach((function(t){t.canRead&&s.push(t.code)})),s?Object(C["c"])({taskCodes:JSON.stringify(s),executorCode:t.code}).then((function(t){if(e.projectMemberModal.modalStatus=!1,!Object(y["a"])(t))return!1;Object(v["g"])({stageCode:a.code}).then((function(t){var e=0;t.data.forEach((function(t){t.canRead||e++})),a.canNotReadCount=e,a.tasksLoading=!1,a.tasks=t.data}))})):this.projectMemberModal.modalStatus=!1},showTaskPri:function(t){return{warning:1==t,error:2==t}},showTimeLabel:function(t){var e="label-primary";if(null==t)return e;var a=moment(moment(t).format("YYYY-MM-DD")).diff(moment().format("YYYY-MM-DD"),"days");return a<0?e="label-danger":0==a?e="label-warning":a>7&&(e="label-normal"),e},showTaskTime:function(t,e){return Object(w["a"])(t,e)},taskDetail:function(t,e){this.$router.push("".concat(this.$route.path,"/detail/").concat(t,"?from=").concat(e))},stageMove:function(t){this.preCode=t.draggedContext.element.code,this.nextCode=t.relatedContext.element.code},stageSort:function(){Object(v["f"])(this.preCode,this.nextCode,this.code)},taskSort:function(t){var e=this;console.log(t);for(var a=t.to.parentNode.parentNode.parentNode.getAttribute("id"),s="",o=0,n=t.to.children.length;o<n;o++)s+=","+t.to.children[o].getAttribute("id");Object(C["r"])({stageCode:a,codes:s.substr(1)}).then((function(t){e.getTaskStages(!1)}))},handleResize:function(t,e){t.barSize&&(this.taskStages[e].fixedCreator=!0)},visibleDraw:function(t){"member"==t?(this.configDraw.visible=!1,this.taskSearch.visible=!1,this.inviteMemberDraw.visible=!this.inviteMemberDraw.visible):"taskSearch"==t?(this.taskSearch.visible=!this.taskSearch.visible,this.configDraw.visible=!1,this.inviteMemberDraw.visible=!1):(this.inviteMemberDraw.visible=!1,this.taskSearch.visible=!1,this.configDraw.visible=!this.configDraw.visible)},removeMember:function(t,e){var a=this;this.$confirm({title:"您确定要将「".concat(t.name,"」从项目中移除吗？"),content:"移除后该成员将不能查看任何关于该项目的信息",okText:"移除",okType:"danger",cancelText:"再想想",onOk:function(){return Object(b["d"])(t.code,a.code).then((function(t){Object(y["a"])(t)&&(a.projectMembers.splice(e,1),Object(_["b"])({title:"移除成功"},"notice","success"))})),Promise.resolve()}})},inviteMember:function(t){Object(b["b"])(t.memberCode,this.projectCode).then((function(e){var a=Object(y["a"])(e);a&&(t.joined=!0)}))},searchInviteMember:c.a.debounce((function(){var t=this;if(this.inviteMemberDraw.keyword||(this.projectMembers=JSON.parse(JSON.stringify(this.projectMembersCopy))),this.inviteMemberDraw.keyword.length<=1)return!1;this.searching=!0,this.projectMembers=this.projectMembers.filter((function(e){return-1!=e.name.indexOf(t.inviteMemberDraw.keyword)}))}),500),updateProject:function(t){this.project=t},collectProject:function(){var t=this,e=this.project.collected?"cancel":"collect";Object(j["a"])(this.project.code,e).then((function(e){Object(y["a"])(e)&&(t.project.collected=!t.project.collected)}))},handleChange:function(t){if("uploading"===t.file.status)return Object(_["b"])("正在导入，请稍后...","message","loading",0),void(this.uploadLoading=!0);if("done"===t.file.status&&(console.log(t),this.uploadLoading=!1,Object(y["a"])(t.file.response,!0))){var e=t.file.response.data;e?Object(_["b"])("成功导入".concat(e,"个任务"),"message","success"):Object(_["b"])("没有成功导入任何任务","message","warning"),this.getTaskStages(!1)}},beforeUpload:function(t){var e=t.size/1024/1024<2;return e||this.$message.error("文件不能超过2MB!"),e}}},T=S,O=(a("64a8"),a("2877")),D=Object(O["a"])(T,s,o,!1,null,null,null);e["default"]=D.exports},b69c:function(t,e,a){},b845:function(t,e,a){},c101:function(t,e,a){},c9b7:function(t,e,a){"use strict";var s=a("0b47"),o=a.n(s);o.a},ca8d:function(t,e,a){"use strict";a.d(e,"j",(function(){return o})),a.d(e,"h",(function(){return n})),a.d(e,"o",(function(){return i})),a.d(e,"t",(function(){return r})),a.d(e,"r",(function(){return c})),a.d(e,"m",(function(){return l})),a.d(e,"u",(function(){return d})),a.d(e,"q",(function(){return u})),a.d(e,"b",(function(){return m})),a.d(e,"c",(function(){return p})),a.d(e,"s",(function(){return f})),a.d(e,"p",(function(){return h})),a.d(e,"l",(function(){return g})),a.d(e,"k",(function(){return v})),a.d(e,"e",(function(){return k})),a.d(e,"d",(function(){return b})),a.d(e,"i",(function(){return C})),a.d(e,"a",(function(){return y})),a.d(e,"n",(function(){return w})),a.d(e,"g",(function(){return j})),a.d(e,"f",(function(){return _}));var s=a("22b6");function o(t){return s["a"].post("project/task",t)}function n(t){return s["a"].post("project/task/getListByTaskTag",t)}function i(t){return s["a"].post("project/task/selfList",t)}function r(t){return s["a"].post("project/task/taskSources",t)}function c(t){return s["a"].post("project/task/sort",t)}function l(t){return s["a"].post("project/task/save",t)}function d(t){return s["a"].post("project/task/taskToTags",t)}function u(t){return s["a"].post("project/task/setTag",t)}function m(t){return s["a"].post("project/task/assignTask",t)}function p(t){return s["a"].post("project/task/batchAssignTask",t)}function f(t,e){return s["a"].post("project/task/taskDone",{taskCode:t,done:e})}function h(t,e){return s["a"].post("project/task/setPrivate",{taskCode:t,private:e})}function g(t){return s["a"].post("project/task/recycleBatch",t)}function v(t){return s["a"].post("project/task/recovery",{taskCode:t})}function k(t){return s["a"].post("project/task/delete",{taskCode:t})}function b(t){return s["a"].post("project/task/dateTotalForProject",t)}function C(t){return s["a"].post("project/project/getLogBySelfProject",t)}function y(t){return s["a"].post("project/task/_taskWorkTimeList",t)}function w(t){return s["a"].post("project/task/saveTaskWorkTime",t)}function j(t){return s["a"].post("project/task/editTaskWorkTime",t)}function _(t){return s["a"].post("project/task/delTaskWorkTime",t)}},cffd:function(t,e,a){},db9e6:function(t,e,a){"use strict";a.d(e,"c",(function(){return o})),a.d(e,"d",(function(){return n})),a.d(e,"b",(function(){return i})),a.d(e,"a",(function(){return r}));var s=a("22b6");function o(t){return s["a"].post("project/task_tag",t)}function n(t){return s["a"].post("project/task_tag/save",t)}function i(t){return s["a"].post("project/task_tag/edit",t)}function r(t){return s["a"].post("project/task_tag/delete",{tagCode:t})}},e3cc:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("a-tabs",{staticClass:"task-tag-index",attrs:{tabPosition:"left",defaultActiveKey:"1",animated:!1},model:{value:t.tabKey,callback:function(e){t.tabKey=e},expression:"tabKey"}},[t._l(t.taskTagList,(function(e){return a("a-tab-pane",{key:e.code},[a("div",{attrs:{slot:"tab"},slot:"tab"},[a("div",{staticClass:"tag-item"},[a("a-badge",{class:"badge-"+e.color,attrs:{status:"success"}}),t._v("\n          "+t._s(e.name)+"\n        ")],1)]),a("div",{staticClass:"config-content"},[a("vue-scroll",[a("div",{staticClass:"content-item"},[a("div",{staticClass:"infos"},[a("a-list",{attrs:{loading:{spinning:t.loading,delay:300}}},[t.showLoadingMore?a("div",{style:{textAlign:"center",marginTop:"12px",height:"32px",lineHeight:"32px"},attrs:{slot:"loadMore"},slot:"loadMore"},[t.loadingMore?a("a-spin"):a("a-button",{on:{click:t.onLoadMore}},[t._v("加载更多")])],1):t._e(),t._l(t.list,(function(e,s){return a("a-list-item",{key:s},[a("a-list-item-meta",[a("div",{staticClass:"task-list",class:{done:e.done},attrs:{slot:"title"},slot:"title"},[a("div",[a("router-link",{staticClass:"text-default task-content",attrs:{to:"/project/space/task/"+t.code+"/detail/"+e.code}},[e.executor&&e.executor.avatar?a("a-tooltip",{attrs:{placement:"top"}},[a("template",{slot:"title"},[a("span",[t._v(t._s(e.executor.name))])]),a("img",{staticClass:"avatar task-executor img-circle img-24 hinted m-r-sm",attrs:{src:e.executor.avatar,title:e.executor.name}})],2):a("a-avatar",{staticClass:"m-r-sm",attrs:{size:"small",icon:"user"}}),a("span",{staticClass:"task-name m-r"},[t._v(t._s(e.name))]),t._l(e.tags,(function(e){return a("span",{key:e.code,staticClass:"muted flex m-r tag-name"},[a("a-badge",{class:"badge-"+e.tag.color+" m-r-xs",attrs:{status:"success"}}),t._v("\n                            "+t._s(e.tag.name)+"\n                          ")],1)}))],2)],1),e.end_time?a("div",{staticClass:"label task-time",class:t.showTimeLabel(e.end_time)},[t._v(t._s(t.showTaskTime(e.begin_time,e.end_time)))]):t._e()])])],1)}))],2)],1)])])],1)])})),t.loading||t.list.length?t._e():a("div",{staticClass:"m-t text-center"},[a("strong",[a("h2",[t._v("项目中还没有标签")])])])],2)],1)},o=[],n=a("2f14"),i=a("db9e6"),r=a("1b80"),c=a("81fe"),l=a("ca8d"),d={name:"taskTag",props:{code:{type:[String],default:function(){return""}}},mixins:[r["a"]],data:function(){return{loading:!1,tabKey:"0",project:{},taskTagList:[],list:[],showLoadingMore:!1,loadingMore:!1}},watch:{code:function(){this.init()},tabKey:function(t){this.getTaskList()}},created:function(){this.init()},methods:{init:function(){var t=this;this.requestData.projectCode=this.code,t.getTaskTags()},getTaskTags:function(){var t=this;Object(i["c"])(t.requestData).then((function(e){t.taskTagList=e.data,e.data.length&&(t.tabKey=e.data[0].code)}))},getTaskList:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!this.tabKey)return!1;var e=this;e.loading=!0,t&&(this.list=[],this.pagination.page=1,this.pagination.pageSize=10,this.showLoadingMore=!1),Object(l["h"])({taskTagCode:this.tabKey}).then((function(t){e.list=e.list.concat(t.data.list),e.pagination.total=t.data.total,e.showLoadingMore=e.pagination.total>e.list.length,e.loading=!1,e.loadingMore=!1}))},onLoadMore:function(){this.loadingMore=!0,this.pagination.page++,this.getTaskList(!1)},showTaskTime:function(t,e){return Object(c["a"])(t,e)},showTimeLabel:function(t){var e="label-primary";if(null==t)return e;var a=moment(moment(t).format("YYYY-MM-DD")).diff(moment().format("YYYY-MM-DD"),"days");return a<0?e="label-danger":0==a?e="label-warning":a>7&&(e="label-normal"),e},deleteItem:function(t,e){var a=this;switch(this.tabKey){case"1":this.$confirm({title:"确定彻底删除任务？",content:"彻底删除任务后，该任务及其子任务将会被永久被删除。",okText:"彻底删除",okType:"danger",cancelText:"再想想",onOk:function(){return Object(i["a"])(t.code).then((function(s){Object(n["a"])(s)&&(a.list.splice(e,1),a.$emit("update",t))})),Promise.resolve()}});break;case"2":this.$confirm({title:"确认彻底删除该文件？",content:"彻底删除文件后，相关的关联资源将会失效。",okText:"彻底删除",okType:"danger",cancelText:"再想想",onOk:function(){return delFile(t.code).then((function(s){Object(n["a"])(s)&&(a.list.splice(e,1),a.$emit("update",t))})),Promise.resolve()}});break}}}},u=d,m=(a("f9ef"),a("2877")),p=Object(m["a"])(u,s,o,!1,null,null,null);e["default"]=p.exports},f8c7:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.currentProject?a("div",{attrs:{id:"project-select"}},[a("a-dropdown",{staticClass:"action-item",attrs:{trigger:["click"],placement:"bottomCenter"},model:{value:t.visibleMenu,callback:function(e){t.visibleMenu=e},expression:"visibleMenu"}},[a("a-tooltip",{attrs:{mouseEnterDelay:.3,title:t.currentProject.name}},[a("a",{staticClass:"project-select",staticStyle:{color:"#333"},on:{click:function(e){t.visibleMenu=!0}}},[a("span",[t._v(t._s(t.currentProject.name))]),a("span",{staticClass:"m-l-xs"},[a("a-icon",{attrs:{type:"down"}})],1)])]),a("div",{staticClass:"middle-menu member-menu project-select-menu",attrs:{slot:"overlay"},slot:"overlay"},[a("div",{staticClass:"search-content"},[a("a-input",{attrs:{size:"large",placeholder:"搜索"},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}},[a("a-icon",{attrs:{slot:"prefix",type:"search"},slot:"prefix"})],1)],1),a("div",{staticClass:"member-list"},[a("vue-scroll",[a("div",{staticClass:"list-group"},[a("a-list",{staticClass:"list-content",attrs:{itemLayout:"horizontal",dataSource:t.projectList,locale:{emptyText:t.keyword&&t.keyword.length>1?"没有找到该项目":""}},scopedSlots:t._u([{key:"renderItem",fn:function(e){return a("a-list-item",{staticClass:"member-list-item",nativeOn:{click:function(a){return t.changeProject(e.code)}}},[a("span",{attrs:{slot:"actions"},slot:"actions"},[a("a-icon",{directives:[{name:"show",rawName:"v-show",value:t.showCheck(e.code),expression:"showCheck(item.code)"}],attrs:{type:"check"}})],1),a("a-list-item-meta",[a("span",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.name))]),a("a-avatar",{attrs:{slot:"avatar",icon:"user",src:e.cover},slot:"avatar"})],1)],1)}}],null,!1,3141279394)})],1)])],1)])],1)],1):t._e()},o=[],n=(a("8e6e"),a("ac6a"),a("456d"),a("7f7f"),a("386d"),a("bd86")),i=a("2ef0"),r=a.n(i),c=a("5880"),l=a("24d2"),d=a("1b80");function u(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,s)}return a}function m(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?u(Object(a),!0).forEach((function(e){Object(n["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):u(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var p={name:"ProjectSelect",props:{code:{type:[String],default:function(){return""}}},data:function(){return{visibleMenu:!1,keyword:"",loading:!1,currentProject:null,projectList:[],projectListCopy:[],projectTotal:0}},mixins:[d["a"]],computed:m({},Object(c["mapState"])({currentOrganization:function(t){return t.currentOrganization},organizationList:function(t){return t.organizationList}})),watch:{code:function(){this.init()},keyword:function(){this.search()}},created:function(){this.init()},methods:{init:function(){this.getProject(),this.getProjectList(!0)},getProject:function(){var t=this;Object(l["b"])(this.code).then((function(e){t.currentProject=e.data}))},getProjectList:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.loading=e,this.requestData.pageSize=50,this.requestData.archive=-1,Object(l["c"])(this.requestData).then((function(e){t.projectList=e.data.list,t.projectListCopy=e.data.list,t.projectTotal=e.data.total,t.loading=!1}))},changeProject:function(t){this.visibleMenu=!1,this.$router.push("/project/space/task/"+t)},showCheck:function(t){if(t==this.code)return!0},search:r.a.debounce((function(){var t=this;if(this.keyword=this.keyword.trim(),this.keyword||(this.projectList=JSON.parse(JSON.stringify(this.projectListCopy))),this.keyword.length<=1)return!1;this.projectList=this.projectList.filter((function(e){return-1!=e.name.indexOf(t.keyword)}))}),500),getPopup:function(){return document.getElementById("project-select")}}},f=p,h=(a("7934"),a("2877")),g=Object(h["a"])(f,s,o,!1,null,null,null);e["default"]=g.exports},f9ef:function(t,e,a){"use strict";var s=a("b69c"),o=a.n(s);o.a}}]);