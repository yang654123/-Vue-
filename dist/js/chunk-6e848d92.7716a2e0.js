(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6e848d92"],{"1b80":function(t,e,s){"use strict";e["a"]={data:function(){return{pagination:{page:1,pageSize:10,total:0,showTotal:function(t,e){return"共 ".concat(t," 条")}}}},computed:{requestData:function(){return{page:this.pagination.page,pageSize:this.pagination.pageSize}}},methods:{init:function(){},pageChange:function(t){this.pagination.page=t,this.requestData.page=t.current,this.init()}}}},"24d2":function(t,e,s){"use strict";s.d(e,"a",(function(){return a})),s.d(e,"c",(function(){return o})),s.d(e,"b",(function(){return n}));var i=s("22b6");function a(t){return i["a"].post("project/project",t)}function o(t){return i["a"].post("project/project/selfList",t)}function n(t){return i["a"].post("project/project/read",{projectCode:t})}},"34e5":function(t,e,s){},"47cb":function(t,e,s){"use strict";var i=s("85de"),a=s.n(i);a.a},"523b":function(t,e,s){"use strict";var i=s("34e5"),a=s.n(i);a.a},"6be7":function(t,e,s){"use strict";s.d(e,"f",(function(){return a})),s.d(e,"l",(function(){return o})),s.d(e,"e",(function(){return n})),s.d(e,"g",(function(){return r})),s.d(e,"k",(function(){return c})),s.d(e,"i",(function(){return l})),s.d(e,"d",(function(){return u})),s.d(e,"j",(function(){return d})),s.d(e,"h",(function(){return p})),s.d(e,"c",(function(){return m})),s.d(e,"b",(function(){return h})),s.d(e,"a",(function(){return v}));var i=s("22b6");function a(t){return i["a"].post("project/project",t)}function o(t){return i["a"].post("project/project/selfList",t)}function n(t){var e="project/project/save";return t.projectCode&&(e="project/project/edit"),i["a"].post(e,t)}function r(t){return i["a"].post("project/project/quit",{projectCode:t})}function c(t){return i["a"].post("project/project/recycle",{projectCode:t})}function l(t){return i["a"].post("project/project/recovery",{projectCode:t})}function u(t){return i["a"].post("project/project/archive",{projectCode:t})}function d(t){return i["a"].post("project/project/recoveryArchive",{projectCode:t})}function p(t){return i["a"].post("project/project/read",{projectCode:t})}function m(t){return i["a"].post("project/project/analysis",t)}function h(t){return i["a"].post("project/project/_projectStats",t)}function v(t){return i["a"].post("project/project/_getProjectReport",t)}},7934:function(t,e,s){"use strict";var i=s("b845"),a=s.n(i);a.a},"85de":function(t,e,s){},"9f09":function(t,e,s){"use strict";s.d(e,"d",(function(){return a})),s.d(e,"a",(function(){return o})),s.d(e,"g",(function(){return n})),s.d(e,"f",(function(){return r})),s.d(e,"e",(function(){return c})),s.d(e,"c",(function(){return l})),s.d(e,"b",(function(){return u}));var i=s("22b6");function a(t){return i["a"].post("project/task_stages",t)}function o(t){return i["a"].post("project/task_stages/_getAll",t)}function n(t){return i["a"].post("project/task_stages/tasks",t)}function r(t,e,s){return i["a"].post("project/task_stages/sort",{preCode:t,nextCode:e,projectCode:s})}function c(t){return i["a"].post("project/task_stages/save",t)}function l(t){return i["a"].post("project/task_stages/edit",t)}function u(t){return i["a"].post("project/task_stages/delete",{code:t})}},b845:function(t,e,s){},bc5b:function(t,e,s){"use strict";s.d(e,"g",(function(){return a})),s.d(e,"f",(function(){return o})),s.d(e,"e",(function(){return n})),s.d(e,"h",(function(){return r})),s.d(e,"j",(function(){return c})),s.d(e,"d",(function(){return l})),s.d(e,"a",(function(){return u})),s.d(e,"i",(function(){return d})),s.d(e,"b",(function(){return p})),s.d(e,"c",(function(){return m}));var i=s("22b6");function a(t){return i["a"].post("project/project_version",t)}function o(t){return i["a"].post("project/project_version/_getVersionTask",t)}function n(t){return i["a"].post("project/project_version/_getVersionLog",t)}function r(t){return i["a"].post("project/project_version/read",t)}function c(t){return i["a"].post("project/project_version/save",t)}function l(t){return i["a"].post("project/project_version/edit",t)}function u(t){return i["a"].post("project/project_version/addVersionTask",t)}function d(t){return i["a"].post("project/project_version/removeVersionTask",t)}function p(t){return i["a"].post("project/project_version/changeStatus",t)}function m(t){return i["a"].post("project/project_version/delete",t)}},beeb:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"version-detail"},[s("a-spin",{staticClass:"version-detail-spin",attrs:{spinning:t.loading}},[s("div",{staticClass:"task-header"},[s("span",{staticClass:"head-title"},[s("span",[t._v(t._s(t.version.featureName))])]),s("span",{staticClass:"header-action text-right"},[[s("a-dropdown",{attrs:{trigger:["click"],placement:"bottomCenter"},model:{value:t.visibleTaskMenu,callback:function(e){t.visibleTaskMenu=e},expression:"visibleTaskMenu"}},[s("a-tooltip",{attrs:{mouseEnterDelay:.5}},[s("template",{slot:"title"},[s("span",[t._v("打开菜单")])]),s("a",{staticClass:"action-item muted"},[s("a-icon",{attrs:{type:"ellipsis"}})],1)],2),s("a-menu",{staticClass:"field-right-menu",attrs:{slot:"overlay"},on:{click:t.doVersion},slot:"overlay"},[s("a-menu-item",{key:"delete"},[s("a-icon",{attrs:{type:"delete"}}),s("span",[t._v("删除版本")])],1)],1)],1)],s("a-tooltip",{attrs:{mouseEnterDelay:.5}},[s("template",{slot:"title"},[s("span",[t._v("关闭面板")])]),s("a",{staticClass:"action-item muted",on:{click:t.detailClose}},[s("a-icon",{attrs:{type:"close"}})],1)],2)],2)]),s("div",{staticClass:"task-wrap"},[s("div",{staticClass:"task-content"},[s("div",{staticClass:"content-left"},[s("vue-scroll",{attrs:{ops:t.scrollOps}},[s("div",{staticClass:"task-title",class:{disabled:t.disableEdit}},[s("a-input",{directives:[{name:"show",rawName:"v-show",value:t.showEditName,expression:"showEditName"}],ref:"inputTitle",attrs:{"auto-focus":"",size:"large"},on:{blur:t.doName},model:{value:t.version.name,callback:function(e){t.$set(t.version,"name",e)},expression:"version.name"}}),t.disableEdit?s("div",{directives:[{name:"show",rawName:"v-show",value:!t.showEditName,expression:"!showEditName"}],staticClass:"title-text"},[t._v(t._s(t.version.name))]):s("a-tooltip",{attrs:{mouseEnterDelay:.5}},[s("template",{slot:"title"},[s("span",[t._v("点击即可编辑")])]),s("div",{directives:[{name:"show",rawName:"v-show",value:!t.showEditName,expression:"!showEditName"}],staticClass:"title-text",on:{click:t.editTitle}},[t._v(t._s(t.version.name))])],2)],1),s("div",{staticClass:"task-basic-attrs-view muted"},[s("div",{staticClass:"field-list",class:{disabled:t.disableEdit}},[s("div",{staticClass:"component-mount"},[s("div",{staticClass:"field"},[s("div",{staticClass:"field-left"},[s("a-icon",{attrs:{type:"check-square"}}),s("span",{staticClass:"field-name"},[t._v("状态")])],1),s("div",{staticClass:"field-right"},[s("a-dropdown",{class:{disabled:t.task.hasUnDone},attrs:{placement:"bottomCenter",trigger:["click"],disabled:!!t.task.deleted||!!t.task.hasUnDone}},[s("a-tooltip",{attrs:{placement:"top"}},[s("template",{slot:"title"},[t.disableEdit?s("span",{staticStyle:{"font-size":"12px"}},[t._v("版本已发布，不能编辑")]):t._e()]),s("span",[s("span",{staticClass:"version-status",class:"status-"+t.version.status},[s("a-icon",{attrs:{type:"schedule"}}),s("span",{staticClass:"m-l-xs"},[t._v("\n                                "+t._s(t.version.statusText)+"\n                              ")])],1)])],2),s("a-menu",{directives:[{name:"show",rawName:"v-show",value:!t.disableEdit,expression:"!disableEdit"}],staticClass:"field-right-menu",attrs:{slot:"overlay",selectable:!1},on:{click:t.changeVersionStatus},slot:"overlay"},[s("a-menu-item",{key:"0"},[s("div",{staticClass:"menu-item-content"},[s("a-tag",[t._v("未开始")]),s("a-icon",{directives:[{name:"show",rawName:"v-show",value:0==t.version.status,expression:"version.status == 0"}],staticClass:"check muted",attrs:{type:"check"}})],1)]),s("a-menu-item",{key:"1"},[s("div",{staticClass:"menu-item-content"},[s("a-tag",{attrs:{color:"blue"}},[t._v("进行中")]),s("a-icon",{directives:[{name:"show",rawName:"v-show",value:1==t.version.status,expression:"version.status == 1"}],staticClass:"check muted",attrs:{type:"check"}})],1)]),s("a-menu-item",{key:"2"},[s("div",{staticClass:"menu-item-content"},[s("a-tag",{attrs:{color:"red"}},[t._v("延期发布")]),s("a-icon",{directives:[{name:"show",rawName:"v-show",value:2==t.version.status,expression:"version.status == 2"}],staticClass:"check muted",attrs:{type:"check"}})],1)]),s("a-menu-item",{key:"3"},[s("div",{staticClass:"menu-item-content"},[s("a-tag",{attrs:{color:"green"}},[t._v("已发布")]),s("a-icon",{directives:[{name:"show",rawName:"v-show",value:3==t.version.status,expression:"version.status == 3"}],staticClass:"check muted",attrs:{type:"check"}})],1)])],1)],1)],1)])]),s("div",{staticClass:"component-mount"},[s("div",{staticClass:"field"},[s("div",{staticClass:"field-left"},[s("a-icon",{attrs:{type:"calendar"}}),s("span",{staticClass:"field-name"},[t._v("开始时间")])],1),s("div",{staticClass:"field-right field-date"},[s("a-dropdown",{attrs:{trigger:["click"],disabled:t.disableEdit},model:{value:t.showStartTime,callback:function(e){t.showStartTime=e},expression:"showStartTime"}},[t.disableEdit?s("div",{staticClass:"field-flex"},[s("a",{staticClass:"muted name",staticStyle:{margin:"0"}},[t.version.setStartTime?[t._v("\n                              "+t._s(t.version.start_time_format)+"\n                            ")]:[t._v("设置开始时间")]],2)]):s("a-tooltip",{attrs:{mouseEnterDelay:.5}},[s("template",{slot:"title"},[s("span",[t._v("点击设置开始时间")])]),s("div",{staticClass:"field-flex"},[s("a",{staticClass:"muted name",staticStyle:{margin:"0"}},[t.version.setStartTime?[t._v("\n                                "+t._s(t.version.start_time_format)+"\n                              ")]:[t._v("设置开始时间")]],2)])],2),s("div",{attrs:{slot:"overlay"},slot:"overlay"},[s("a-date-picker",{attrs:{size:"small",format:"MM月DD日 HH:mm",showTime:"",allowClear:"",showToday:!1,open:t.showStartTime},on:{ok:function(e){return t.doStartTime(!0)}},model:{value:t.version.start_time,callback:function(e){t.$set(t.version,"start_time",e)},expression:"version.start_time"}},[s("template",{slot:"renderExtraFooter"},[s("a",{staticStyle:{position:"absolute"},attrs:{size:"small"},on:{click:function(e){return t.doStartTime(!1)}}},[t._v("清除")])])],2)],1)],1)],1)])]),s("div",{staticClass:"component-mount"},[s("div",{staticClass:"field"},[s("div",{staticClass:"field-left"},[s("a-icon",{attrs:{type:"calendar"}}),s("span",{staticClass:"field-name"},[t._v("发布时间")])],1),s("div",{staticClass:"field-right field-date"},[s("a-dropdown",{attrs:{trigger:["click"],disabled:t.disableEdit},model:{value:t.showPlanPublishTime,callback:function(e){t.showPlanPublishTime=e},expression:"showPlanPublishTime"}},[t.disableEdit?s("div",{staticClass:"field-flex"},[s("a",{staticClass:"muted name",staticStyle:{margin:"0"}},[t.version.setPlanPublishTime?[t._v("\n                              "+t._s(t.version.plan_publish_time_format)+"\n                            ")]:[t._v("设置发布时间")]],2)]):s("a-tooltip",{attrs:{mouseEnterDelay:.5}},[s("template",{slot:"title"},[s("span",[t._v("点击设置发布时间")])]),s("div",{staticClass:"field-flex"},[s("a",{staticClass:"muted name",staticStyle:{margin:"0"}},[t.version.setPlanPublishTime?[t._v("\n                                "+t._s(t.version.plan_publish_time_format)+"\n                              ")]:[t._v("设置发布时间")]],2)])],2),s("div",{attrs:{slot:"overlay"},slot:"overlay"},[s("a-date-picker",{attrs:{size:"small",format:"MM月DD日 HH:mm",showTime:"",allowClear:"",showToday:!1,open:t.showPlanPublishTime},on:{ok:function(e){return t.doPlanPublishTime(!0)}},model:{value:t.version.plan_publish_time,callback:function(e){t.$set(t.version,"plan_publish_time",e)},expression:"version.plan_publish_time"}},[s("template",{slot:"renderExtraFooter"},[s("a",{staticStyle:{position:"absolute"},attrs:{size:"small"},on:{click:function(e){return t.doPlanPublishTime(!1)}}},[t._v("清除")])])],2)],1)],1)],1)])]),s("div",{staticClass:"component-mount"},[s("div",{staticClass:"field"},[s("div",{staticClass:"field-left"},[s("a-icon",{attrs:{type:"fire"}}),s("span",{staticClass:"field-name"},[t._v("完成进度")])],1),s("div",{staticClass:"field-right width-block"},[s("a-tooltip",{attrs:{placement:"top",mouseEnterDelay:.3,title:"系统自动统计当前版本的完成进度"}},[s("a-progress",{attrs:{strokeWidth:4,percent:t.version.schedule}})],1)],1)])]),s("div",{staticClass:"component-mount"},[s("div",{staticClass:"field"},[s("div",{staticClass:"field-left"},[s("a-icon",{attrs:{type:"file-text"}}),s("span",{staticClass:"field-name"},[t._v("备注")])],1),s("div",{staticClass:"field-right width-block"},[s("div",{directives:[{name:"show",rawName:"v-show",value:!t.showVersionDescriptionEdit,expression:"!showVersionDescriptionEdit"}],staticClass:"task-description",class:{disabled:t.disableEdit},on:{click:t.showVersionDesc}},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.version.description,expression:"version.description"}],staticClass:"description-txt",domProps:{innerHTML:t._s(t.version.description)}}),s("span",{directives:[{name:"show",rawName:"v-show",value:!t.version.description,expression:"!version.description"}]},[t._v("添加备注")])]),s("div",{directives:[{name:"show",rawName:"v-show",value:t.showVersionDescriptionEdit,expression:"showVersionDescriptionEdit"}]},[s("a-input",{attrs:{type:"textarea"},model:{value:t.version.description,callback:function(e){t.$set(t.version,"description",e)},expression:"version.description"}}),s("div",{staticClass:"action-btn pull-right"},[s("a",{staticClass:"cancel-text muted",attrs:{type:"text"},on:{click:function(e){t.showVersionDescriptionEdit=!1}}},[t._v("取消")]),s("a-button",{staticClass:"middle-btn",attrs:{type:"primary",htmlType:"submit"},on:{click:t.doContent}},[t._v("保存")])],1)],1)])])]),s("div",{staticClass:"component-mount"},[s("div",{staticClass:"field"},[s("div",{staticClass:"field-left"},[s("a-icon",{attrs:{type:"bars"}}),s("span",{staticClass:"field-name"},[t._v("\n                        发布内容\n                        "),s("span",{directives:[{name:"show",rawName:"v-show",value:!1!==t.versionTaskSchedule,expression:"versionTaskSchedule !== false"}]},[t._v("\n                          · "+t._s(t.versionTaskDoneNum)+"/"+t._s(t.versionTaskList.length)+"\n                        ")])])],1),s("div",{staticClass:"field-right width-block"})])]),s("div",{staticClass:"component-mount"},[s("div",{staticClass:"field"},[s("div",{staticClass:"block-field width-block"},[s("div",{staticClass:"task-child"},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.versionTaskList.length,expression:"versionTaskList.length"}],staticClass:"task-list"},t._l(t.versionTaskList,(function(e,i){return s("div",{key:e.code},[s("div",{staticClass:"list-item task"},[s("div",{staticClass:"check-box-wrapper task-item",on:{click:function(s){return s.stopPropagation(),t.showTaskDetail(e)}}},[s("a-icon",{staticClass:"check-box disabled",style:{fontSize:"16px"},attrs:{type:e.done?"check-square":"border"}})],1),s("a-tooltip",{attrs:{mouseEnterDelay:.5}},[s("template",{slot:"title"},[e.executor?s("span",[t._v("\n                                    "+t._s(e.executor.name)+"\n                                  ")]):s("span",[t._v("待认领")])]),s("div",{on:{click:function(s){return s.stopPropagation(),t.showTaskDetail(e)}}},[e.executor?s("a-avatar",{staticClass:"task-item",attrs:{size:"small",icon:"user",src:e.executor.avatar}}):s("a-avatar",{staticClass:"task-item",attrs:{size:"small",icon:"user"}})],1)],2),s("div",{staticClass:"task-item task-title",on:{click:function(s){return s.stopPropagation(),t.showTaskDetail(e)}}},[s("div",{staticClass:"title-text"},[t._v(t._s(e.name))])]),s("span",{staticClass:"m-r muted"},[e.done?s("span",{staticClass:"text-success"},[t._v("已完成")]):s("span",[t._v("未完成")])]),s("a",{staticClass:"muted",on:{click:function(s){return s.stopPropagation(),t.removeVersionTask(e)}}},[s("a-icon",{staticClass:"task-item",attrs:{type:"delete"}})],1)],1)])})),0),s("a-tooltip",{attrs:{placement:"top"}},[s("a",{directives:[{name:"show",rawName:"v-show",value:!t.showChildTask,expression:"!showChildTask"}],staticClass:"add-handler",class:{disabled:t.disableEdit},on:{click:t.getTaskStages}},[s("a-icon",{staticStyle:{"margin-right":"6px"},attrs:{type:"plus"}}),t._v("添加发布内容\n                          ")],1)])],1)])])])])])])],1),s("div",{staticClass:"content-right"},[s("div",{staticClass:"log-wrap"},[s("div",{staticClass:"header"},[s("span",{staticClass:"text-default"},[t._v("所有动态")])]),s("vue-scroll",[s("div",{staticClass:"log-list muted"},[s("a",{directives:[{name:"show",rawName:"v-show",value:t.checkShowMoreLog,expression:"checkShowMoreLog"}],staticClass:"show-more muted",on:{click:t.getMoreVersionLog}},[s("a-icon",{attrs:{type:"ellipsis"}}),t._v("\n                  显示较早的 "+t._s(t.versionLogTotal-t.versionLog.length)+" 条动态\n                ")],1),t._l(t.versionLog,(function(e){return s("div",{key:e.code,staticClass:"list-item"},[[s("a-icon",{staticClass:"log-item",attrs:{type:e.icon}}),s("div",{staticClass:"log-item log-txt"},[s("div",[t._v("\n                        "+t._s(e.member.name)+"\n                        "),s("span",{domProps:{innerHTML:t._s(e.remark)}})]),e.content?s("div",{staticClass:"log-content",domProps:{innerHTML:t._s(e.content)}}):t._e()])],s("a-tooltip",{attrs:{mouseEnterDelay:.5}},[s("template",{slot:"title"},[s("span",[t._v(t._s(e.create_time))])]),s("span",{staticClass:"log-item"},[t._v("\n                      "+t._s(t._f("formatLogTime")(e.create_time))+"\n                    ")])],2)],2)}))],2)])],1)])])])]),s("a-modal",{attrs:{destroyOnClose:"",width:360,title:"实际发布时间",bodyStyle:{paddingBottom:"1px"},footer:null},model:{value:t.publishVersion.modalStatus,callback:function(e){t.$set(t.publishVersion,"modalStatus",e)},expression:"publishVersion.modalStatus"}},[s("a-form",{attrs:{form:t.publishVersionForm},on:{submit:function(e){return e.preventDefault(),t.handleSubmitPublishVersion(e)}}},[s("a-form-item",[s("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["publishTime"],expression:"['publishTime']"}],staticStyle:{width:"100%"},attrs:{showTime:"",format:"YYYY年MM月DD日 HH:mm",placeholder:"选择实际发布时间"}})],1),s("a-form-item",[s("div",{staticClass:"action-btn"},[s("a-button",{staticClass:"middle-btn",attrs:{type:"primary",htmlType:"submit",block:"",size:"large",loading:t.publishVersion.confirmLoading}},[t._v("确认发布")])],1)])],1)],1),s("a-modal",{staticClass:"publish-task-modal",attrs:{destroyOnClose:"",width:800,title:"规划发布内容",footer:null},model:{value:t.publishTask.modalStatus,callback:function(e){t.$set(t.publishTask,"modalStatus",e)},expression:"publishTask.modalStatus"}},[s("div",[s("p",{directives:[{name:"show",rawName:"v-show",value:t.publishTask.selectTaskList.length,expression:"publishTask.selectTaskList.length"}]},[t._v("\n        已选择\n        "),s("span",{staticClass:"text-warning"},[t._v("\n          "+t._s(t.publishTask.selectTaskList.length)+"\n        ")]),t._v("\n        项\n      ")]),s("p",{directives:[{name:"show",rawName:"v-show",value:!t.publishTask.selectTaskList.length,expression:"!publishTask.selectTaskList.length"}],staticClass:"muted"},[t._v("请勾选需要发布的内容")])]),s("vue-scroll",[s("div",{staticClass:"publish-task"},[s("a-checkbox-group",{model:{value:t.publishTask.selectTaskList,callback:function(e){t.$set(t.publishTask,"selectTaskList",e)},expression:"publishTask.selectTaskList"}},t._l(t.publishTask.taskStages,(function(e,i){return s("div",{key:i,staticClass:"m-b"},[s("strong",[t._v(t._s(e.name))]),s("a-list",{staticClass:"publish-task-list",attrs:{loading:e.tasksLoading,itemLayout:"horizontal",dataSource:e.tasks},scopedSlots:t._u([{key:"renderItem",fn:function(e,i){return s("a-list-item",{},[s("a-list-item-meta",[s("div",{class:{muted:e.version_code},attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.name))]),s("div",{attrs:{slot:"avatar"},slot:"avatar"},[s("a-checkbox",{attrs:{value:e.code}})],1)])],1)}}],null,!0)})],1)})),0)],1)]),s("div",{staticClass:"footer-item text-right m-t"},[s("a-button",{staticClass:"middle-btn",attrs:{type:"primary",size:"large"},on:{click:t.addVersionTask}},[t._v("保存")])],1)],1),s("a-modal",{staticClass:"task-detail-modal",attrs:{destroyOnClose:"",width:"min-content",closable:!1,title:"",footer:null},on:{cancel:t.taskDetailClose},model:{value:t.showTaskDetailModal,callback:function(e){t.showTaskDetailModal=e},expression:"showTaskDetailModal"}},[s("task-detail",{attrs:{taskCode:t.taskCode},on:{close:t.taskDetailClose}})],1)],1)},a=[],o=(s("8e6e"),s("456d"),s("ac6a"),s("7f7f"),s("bd86")),n=(s("c5f6"),s("5880")),r=s("009f"),c=s("bc5b"),l=s("81fe"),u=s("2f14"),d=s("9f09"),p=s("97a8");function m(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,i)}return s}function h(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?m(Object(s),!0).forEach((function(e){Object(o["a"])(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):m(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}var v={name:"version-detail",components:{taskDetail:r["default"]},props:{versionCode:{type:[String],default:function(){return""}},width:{type:[String,Number],default:function(){return"1200"}}},data:function(){return{loading:!1,code:this.versionCode,projectCodeCurrent:"",task:{},showTaskDetailModal:!1,taskCode:"",version:{},visibleTaskMenu:!1,versionName:"",showEditName:!1,showStartTime:!1,showPlanPublishTime:!1,showVersionDescriptionEdit:!1,versionTaskList:[],showChildTask:!1,versionLogTotal:0,versionLog:[],publishVersionForm:this.$form.createForm(this),publishVersion:{modalStatus:!1,confirmLoading:!1,status:-1},showMoreTaskLog:0,hasMoreVersionLog:!1,hideShowMore:!1,publishTask:{modalStatus:!1,confirmLoading:!1,loading:!1,selectTaskList:[],taskStages:[]}}},computed:h({},Object(n["mapState"])({userInfo:function(t){return t.userInfo}}),{disableEdit:function(){return 3==this.version.status},versionTaskDoneNum:function(){var t=this.versionTaskList.filter((function(t){return 1==t.done}));return t.length},checkShowMoreLog:function(){return!this.hideShowMore&&this.versionLogTotal>5},versionTaskSchedule:function(){return!!this.versionTaskList.length&&this.versionTaskDoneNum/this.versionTaskList.length*100},scrollOps:function(){return{rail:{background:"#e5e5e5",opacity:1},bar:{keepShow:!0}}}}),watch:{$route:function(t,e){}},created:function(){this.init()},mounted:function(){var t=this,e=arguments;this.changeModalHeight(),window.onresize=function(){return function(){t.changeModalHeight()}()},document.onkeydown=function(s){var i=s||window.event||e.callee.caller.arguments[0];13==i.keyCode&&i.ctrlKey&&t.createComment()}},filters:{formatLogTime:function(t){return Object(l["c"])(t)}},methods:{init:function(){this.loading=!0,this.getVersion(),this.getVersionTask()},detailClose:function(){this.$emit("close",this.version)},getVersion:function(){var t=this;Object(c["h"])({versionCode:this.code}).then((function(e){t.getVersionLog(),t.version=e.data,t.versionName=e.data.name,t.version.start_time?(t.version.setStartTime=!0,t.version.start_time=moment(t.version.start_time)):(t.version.setStartTime=!1,t.version.start_time=moment(moment().format("YYYY-MM-DD")+" 18:00")),t.version.start_time_format=Object(l["b"])(t.version.start_time,!0),t.version.plan_publish_time?(t.version.setPlanPublishTime=!0,t.version.plan_publish_time=moment(t.version.plan_publish_time)):(t.version.setPlanPublishTime=!1,t.version.plan_publish_time=moment(moment().format("YYYY-MM-DD")+" 18:00")),t.version.plan_publish_time_format=Object(l["b"])(t.version.plan_publish_time,!0),t.loading=!1}))},getVersionTask:function(){var t=this;Object(c["f"])({versionCode:this.code}).then((function(e){t.versionTaskList=e.data}))},getVersionLog:function(){var t=this;Object(c["e"])({versionCode:this.code,all:this.showMoreVersionLog,pageSize:5}).then((function(e){t.versionLog=e.data.list,t.versionLogTotal=e.data.total,e.data.total>5&&(t.hasMoreVersionLog=!0)}))},getMoreVersionLog:function(){this.showMoreVersionLog=1,this.hideShowMore=!0,this.getVersionLog()},getTaskStages:function(){var t=this;if(this.disableEdit)return!1;this.publishTask.modalStatus=!0,this.publishTask.loading=!0,Object(d["d"])({projectCode:this.version.projectCode,pageSize:30}).then((function(e){t.publishTask.taskStages=e.data.list,t.publishTask.taskStages&&t.publishTask.taskStages.forEach((function(t){Object(d["g"])({stageCode:t.code}).then((function(e){t.tasksLoading=!1,t.tasks=e.data}))})),t.changeModalHeight(),t.publishTask.loading=!1}))},showTaskDetail:function(t){this.showTaskDetailModal=!0,this.taskCode=t.code},taskDetailClose:function(){this.init(),this.showTaskDetailModal=!1,this.taskCode=""},doVersion:function(t){var e=this,s=t.key;switch(s){case"delete":this.$confirm({title:"删除版本",content:"删除版本后，发布内容的版本字段将被清空，是否确定删除？",okText:"确定",okType:"danger",cancelText:"再想想",onOk:function(){return Object(c["c"])({versionCode:e.code}).then((function(t){var s=Object(u["a"])(t);if(!s)return!1;e.detailClose()})),Promise.resolve()}});break}this.visibleTaskMenu=!1},editTitle:function(){var t=this;this.showEditName=!0,this.$nextTick((function(){t.$refs.inputTitle.focus()}))},deleteTask:function(){var t=this;this.$confirm({title:"彻底删除",content:"彻底删除任务后，该任务及其子任务将会被永久被删除。",okText:"删除",okType:"danger",cancelText:"再想想",onOk:function(){return Object(c["c"])(t.code).then((function(e){t.detailClose()})),Promise.resolve()}})},changeVersionStatus:function(t){var e=this,s=this;if(t.key==this.version.code||3==this.version.status)return!1;3==t.key?this.$confirm({title:"发布提示",content:"请确认当前版本发布内容已全部完成后再发布。",okText:"确认发布",okType:"primary",onOk:function(){return s.publishVersion.status=t.key,s.publishVersion.modalStatus=!0,s.$nextTick((function(){s.publishVersionForm.setFieldsValue({publishTime:moment()})})),Promise.resolve()}}):Object(c["b"])({versionCode:this.version.code,status:t.key}).then((function(t){e.getVersion()}))},handleSubmitPublishVersion:function(){var t=this,e=this;e.publishVersionForm.validateFields((function(s){if(!s){var i=e.publishVersionForm.getFieldsValue();i.publishTime=moment(i.publishTime).format("YYYY-MM-DD HH:mm"),Object(c["b"])({versionCode:t.code,status:t.publishVersion.status,publishTime:i.publishTime}).then((function(t){e.publishVersion.modalStatus=!1,e.getVersion()}))}}))},doStartTime:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.version.setStartTime=t,this.showStartTime=e;var s="";t?(s=moment(this.version.start_time).format("YYYY-MM-DD HH:mm"),this.version.start_time_format=moment(this.version.start_time).format("MM月DD日 HH:mm")):s="",this.editVersion({start_time:s})},doPlanPublishTime:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.version.setPlanPublishTime=t,this.showPlanPublishTime=e;var s="";t?(s=moment(this.version.plan_publish_time).format("YYYY-MM-DD HH:mm"),this.version.plan_publish_time_format=moment(this.version.plan_publish_time).format("MM月DD日 HH:mm")):s="",this.editVersion({plan_publish_time:s})},doName:function(){if(this.showEditName=!1,!this.version.name.trim()||this.version.name==this.versionName)return this.version.name=this.versionName,!1;this.editVersion({name:this.version.name})},editVersion:function(t){var e=this;t.versionCode=this.code,Object(c["d"])(t).then((function(t){var s=Object(u["a"])(t);if(!s)return!1;e.getVersion()}))},showVersionDesc:function(){if(this.disableEdit)return!1;this.showVersionDescriptionEdit=!0},doContent:function(){var t=this.version.description;this.editVersion({description:t}),this.showVersionDescriptionEdit=!1},addVersionTask:function(){var t=this;Object(c["a"])({taskCodeList:JSON.stringify(this.publishTask.selectTaskList),versionCode:this.code}).then((function(e){Object(p["b"])({title:"成功添加 ".concat(e.data.successTotal," 项发布内容到版本")},"notice","success"),t.publishTask.modalStatus=!1,t.publishTask.selectTaskList=[],t.init()}))},removeVersionTask:function(t){var e=this;this.$confirm({title:"移除发布内容",content:"确定移除这个发布内容？",okText:"确定",okType:"danger",cancelText:"再想想",onOk:function(){return Object(c["i"])({taskCode:t.code}).then((function(t){var s=Object(u["a"])(t);if(!s)return!1;e.init()})),Promise.resolve()}})},changeModalHeight:function(){var t=this.width,e=$(window).width()-100,s=$(window).height()-150,i=$(window).height()-200,a=$(window).height()-255;"full-screen"===t||void 0!==this.$route.query["full-screen"]?($(".task-detail-modal").css("width",$(window).width()),$(".version-detail").css("width",$(window).width()),$(".ant-modal").css("top",0),s+=85,i+=85,$(".content-left").css("height",s+"px"),$(".log-wrap").css("height",i+"px")):(e>t&&(e=t),$(".version-detail").css("width",e),$(".content-left").css("height",s+"px"),$(".log-wrap").css("height",i+"px"),$(".publish-task").css("height",a+"px"))}}},f=v,b=(s("523b"),s("2877")),k=Object(b["a"])(f,i,a,!1,null,null,null);e["default"]=k.exports},dea8:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"project-space-features",class:t.project.task_board_theme},[s("div",{staticClass:"project-navigation"},[s("div",{staticClass:"project-nav-header"},[s("a-breadcrumb",[s("a-breadcrumb-item",[s("router-link",{attrs:{to:"/home"}},[s("a-icon",{attrs:{type:"home"}}),t._v("首页\n          ")],1)],1),s("a-breadcrumb-item",[s("project-select",{staticClass:"nav-title",staticStyle:{display:"inline-block"},attrs:{code:t.code}}),s("span",{staticClass:"actions"},[s("a-tooltip",{attrs:{mouseEnterDelay:.3,title:t.project.collected?"取消收藏":"加入收藏"},on:{click:t.collectProject}},[s("a-icon",{directives:[{name:"show",rawName:"v-show",value:!t.project.collected,expression:"!project.collected"}],staticStyle:{color:"grey"},attrs:{type:"star",theme:"filled"}}),s("a-icon",{directives:[{name:"show",rawName:"v-show",value:t.project.collected,expression:"project.collected"}],staticStyle:{color:"#ffaf38"},attrs:{type:"star",theme:"filled"}})],1)],1),0===t.project.private?s("span",{staticClass:"label label-normal"},[s("a-icon",{attrs:{type:"global"}}),t._v("公开\n          ")],1):t._e()],1)],1)],1),s("section",{staticClass:"nav-body"},[s("ul",{staticClass:"nav-wrapper nav nav-underscore pull-left"},[s("li",[s("a",{staticClass:"app",attrs:{"data-app":"tasks"},on:{click:function(e){return t.$router.push("/project/space/task/"+t.code)}}},[t._v("任务")])]),s("li",{},[s("a",{staticClass:"app",attrs:{"data-app":"works"},on:{click:function(e){return t.$router.push("/project/space/files/"+t.code)}}},[t._v("文件")])]),s("li",[s("a",{staticClass:"app",attrs:{"data-app":"build"},on:{click:function(e){return t.$router.push("/project/space/overview/"+t.code)}}},[t._v("概览")])]),s("li",{staticClass:"actives"},[s("a",{staticClass:"app",attrs:{"data-app":"build"},on:{click:function(e){return t.$router.push("/project/space/features/"+t.code)}}},[t._v("版本")])])])])]),s("wrapper-content",{attrs:{showHeader:!1}},[s("div",{staticClass:"content-wrapper"},[s("div",{staticClass:"content-item features-content"},[s("div",{staticClass:"actions m-t"},[t.currentProjectFeatures?s("a-dropdown",{attrs:{placement:"bottomCenter",trigger:["click"]}},[s("a",{staticClass:"m-r text-default features-list-dropdown"},[s("span",{staticClass:"m-r-xs"},[t._v(t._s(t.currentProjectFeatures.name))]),s("a-icon",{attrs:{type:"down"}})],1),s("a-menu",{staticClass:"field-right-menu",attrs:{slot:"overlay",selectable:!1},on:{click:t.changeProjectFeatures},slot:"overlay"},t._l(t.projectFeaturesList,(function(e){return s("a-menu-item",{key:e.code},[s("div",{staticClass:"menu-item-content"},[s("div",[s("a-radio",{attrs:{checked:t.currentProjectFeatures.code==e.code}}),s("span",{attrs:{color:"green"}},[t._v(t._s(e.name))])],1),s("div",[s("a",{staticClass:"muted"},[s("a-icon",{attrs:{type:"edit"},on:{click:function(s){return s.stopPropagation(),t.editFeatures(e)}}})],1),s("a",{staticClass:"muted"},[s("a-icon",{staticClass:"m-l",attrs:{type:"delete"},on:{click:function(s){return s.stopPropagation(),t.deleteFeatures(e)}}})],1)])])])})),1)],1):t._e(),s("a-button",{attrs:{icon:"plus",type:"primary"},on:{click:t.createFeatures}},[t._v("创建版本库")]),s("a-divider",{staticClass:"m-b-lg m-t-lg"})],1),t.currentProjectFeatures?s("a-spin",{attrs:{spinning:t.loading}},[t.versionTotal?t._l(t.versionList,(function(e,i){return s("div",{key:i},["published"==i&&e.length?s("a",{staticClass:"muted m-l-sm m-b-sm",staticStyle:{cursor:"pointer",display:"block"},on:{click:function(e){t.showPublished=!t.showPublished}}},[s("span",{staticClass:"m-r-sm"},[t._v("已发布版本")]),s("a-icon",{directives:[{name:"show",rawName:"v-show",value:t.showPublished,expression:"showPublished"}],attrs:{type:"up"}}),s("a-icon",{directives:[{name:"show",rawName:"v-show",value:!t.showPublished,expression:"!showPublished"}],attrs:{type:"ellipsis"}})],1):t._e(),s("div",{staticClass:"version-content",class:{published:"published"==i}},[t._l(e,(function(e,a){return[s("a-card",{directives:[{name:"show",rawName:"v-show",value:"published"!=i||"published"==i&&t.showPublished,expression:"\n                      versionType != 'published' ||\n                      (versionType == 'published' && showPublished)\n                    "}],key:a,staticClass:"version-item",attrs:{hoverable:""},on:{click:function(s){return t.showVersionDetail(e.code)}}},[s("template",{slot:"title"},[s("strong",{class:{muted:"published"==i}},[t._v("\n                        "+t._s(e.name)+"\n                      ")]),s("a-dropdown",{directives:[{name:"show",rawName:"v-show",value:"normal"==i,expression:"versionType == 'normal'"}],attrs:{placement:"bottomCenter",trigger:["click"]}},[s("span",{staticClass:"version-status",class:"status-"+e.status,on:{click:function(t){t.stopPropagation()}}},[s("a-icon",{attrs:{type:"schedule"}}),s("span",{staticClass:"m-l-xs"},[t._v(t._s(e.statusText))])],1),s("a-menu",{staticClass:"field-right-menu",attrs:{slot:"overlay",selectable:!1},on:{click:function(s){return t.changeVersionStatus(s,i,e,a)}},slot:"overlay"},[s("a-menu-item",{key:"0"},[s("div",{staticClass:"menu-item-content"},[s("a-tag",[t._v("未开始")]),s("a-icon",{directives:[{name:"show",rawName:"v-show",value:0==e.status,expression:"version.status == 0"}],staticClass:"check muted",attrs:{type:"check"}})],1)]),s("a-menu-item",{key:"1"},[s("div",{staticClass:"menu-item-content"},[s("a-tag",{attrs:{color:"blue"}},[t._v("进行中")]),s("a-icon",{directives:[{name:"show",rawName:"v-show",value:1==e.status,expression:"version.status == 1"}],staticClass:"check muted",attrs:{type:"check"}})],1)]),s("a-menu-item",{key:"2"},[s("div",{staticClass:"menu-item-content"},[s("a-tag",{attrs:{color:"red"}},[t._v("延期发布")]),s("a-icon",{directives:[{name:"show",rawName:"v-show",value:2==e.status,expression:"version.status == 2"}],staticClass:"check muted",attrs:{type:"check"}})],1)]),s("a-menu-item",{key:"3"},[s("div",{staticClass:"menu-item-content"},[s("a-tag",{attrs:{color:"green"}},[t._v("已发布")]),s("a-icon",{directives:[{name:"show",rawName:"v-show",value:3==e.status,expression:"version.status == 3"}],staticClass:"check muted",attrs:{type:"check"}})],1)])],1)],1)],1),s("div",{staticClass:"publish-time muted"},[e.publish_time||e.plan_publish_time?[s("span","normal"==i?[t._v("预计发布时间："+t._s(e.plan_publish_time))]:[t._v("发布时间："+t._s(e.publish_time))])]:t._e()],2),s("a-tooltip",{directives:[{name:"show",rawName:"v-show",value:"normal"==i,expression:"versionType == 'normal'"}],attrs:{placement:"top",mouseEnterDelay:.3,title:"当前进度："+e.schedule+"%"}},[s("a-progress",{attrs:{strokeWidth:4,showInfo:!1,percent:parseInt(e.schedule)}})],1)],2)]})),s("a-card",{directives:[{name:"show",rawName:"v-show",value:"normal"==i,expression:"versionType == 'normal'"}],staticClass:"version-item version-create",attrs:{hoverable:""},on:{click:t.createVersion}},[s("a",{staticClass:"muted"},[s("div",[s("a-icon",{attrs:{type:"plus"}}),s("div",[t._v("创建版本")])],1)])])],2)])})):s("div",{staticClass:"text-center"},[s("p",{staticClass:"muted"},[t._v("暂无可用版本")]),s("a-button",{attrs:{type:"primary"},on:{click:t.createVersion}},[t._v("创建版本")])],1)],2):t._e()],1)])]),s("a-modal",{attrs:{destroyOnClose:"",width:360,title:t.projectFeatures.modalTitle,bodyStyle:{paddingBottom:"1px"},footer:null},model:{value:t.projectFeatures.modalStatus,callback:function(e){t.$set(t.projectFeatures,"modalStatus",e)},expression:"projectFeatures.modalStatus"}},[s("a-form",{attrs:{form:t.form},on:{submit:function(e){return e.preventDefault(),t.handleSubmit(e)}}},[s("a-form-item",[s("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,message:"请输入版本库名称"}]}],expression:"[\n            'name',\n            {rules: [{required: true, message: '请输入版本库名称'}]},\n          ]"}],attrs:{placeholder:"版本库名称"}})],1),s("a-form-item",[s("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["description"],expression:"['description']"}],attrs:{placeholder:"版本库简介",rows:2}})],1),s("a-form-item",[s("div",{staticClass:"action-btn"},[s("a-button",{staticClass:"middle-btn",attrs:{type:"primary",htmlType:"submit",block:"",size:"large",loading:t.projectFeatures.confirmLoading}},[t._v(t._s(t.projectFeatures.modalTitle))])],1)])],1)],1),s("a-modal",{attrs:{destroyOnClose:"",width:500,title:t.projectVersion.modalTitle,bodyStyle:{paddingBottom:"1px"},footer:null},model:{value:t.projectVersion.modalStatus,callback:function(e){t.$set(t.projectVersion,"modalStatus",e)},expression:"projectVersion.modalStatus"}},[s("a-form",{attrs:{form:t.projectVersionForm},on:{submit:function(e){return e.preventDefault(),t.handleSubmitProjectVersion(e)}}},[s("a-form-item",[s("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,message:"请输入版本名称"}]}],expression:"[\n            'name',\n            {rules: [{required: true, message: '请输入版本名称'}]},\n          ]"}],attrs:{placeholder:"版本名称"}})],1),s("a-form-item",[s("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["description"],expression:"['description']"}],attrs:{placeholder:"版本备注",rows:2}})],1),s("a-form-item",[s("a-row",{attrs:{gutter:16}},[s("a-col",{attrs:{span:12}},[s("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["startTime"],expression:"['startTime']"}],staticStyle:{width:"100%"},attrs:{showTime:"",format:"YYYY年MM月DD日 HH:mm",placeholder:"选择开始时间"}})],1),s("a-col",{attrs:{span:12}},[s("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["planPublishTime"],expression:"['planPublishTime']"}],staticStyle:{width:"100%"},attrs:{showTime:"",format:"YYYY年MM月DD日 HH:mm",placeholder:"选择预计发布时间"}})],1)],1)],1),s("a-form-item",[s("div",{staticClass:"action-btn"},[s("a-button",{staticClass:"middle-btn",attrs:{type:"primary",htmlType:"submit",block:"",size:"large",loading:t.projectVersion.confirmLoading}},[t._v("创建版本")])],1)])],1)],1),s("a-modal",{attrs:{destroyOnClose:"",width:360,title:"实际发布时间",bodyStyle:{paddingBottom:"1px"},footer:null},model:{value:t.publishVersion.modalStatus,callback:function(e){t.$set(t.publishVersion,"modalStatus",e)},expression:"publishVersion.modalStatus"}},[s("a-form",{attrs:{form:t.publishVersionForm},on:{submit:function(e){return e.preventDefault(),t.handleSubmitPublishVersion(e)}}},[s("a-form-item",[s("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["publishTime"],expression:"['publishTime']"}],staticStyle:{width:"100%"},attrs:{showTime:"",format:"YYYY年MM月DD日 HH:mm",placeholder:"选择实际发布时间"}})],1),s("a-form-item",[s("div",{staticClass:"action-btn"},[s("a-button",{staticClass:"middle-btn",attrs:{type:"primary",htmlType:"submit",block:"",size:"large",loading:t.publishVersion.confirmLoading}},[t._v("确认发布")])],1)])],1)],1),s("a-modal",{staticClass:"task-detail-modal",attrs:{destroyOnClose:"",width:"min-content",closable:!1,title:"",footer:null},on:{cancel:t.versionDetailClose},model:{value:t.versionDetail.modalStatus,callback:function(e){t.$set(t.versionDetail,"modalStatus",e)},expression:"versionDetail.modalStatus"}},[s("version-detail",{attrs:{versionCode:t.versionDetail.code},on:{close:t.versionDetailClose}})],1)],1)},a=[],o=(s("7514"),s("7f7f"),s("ac6a"),s("6be7")),n=s("e55b"),r=s("2f14"),c=s("81fe"),l=s("1b80"),u=s("22b6");function d(t){return u["a"].post("project/project_features",t)}function p(t){return u["a"].post("project/project_features/save",t)}function m(t){return u["a"].post("project/project_features/edit",t)}function h(t){return u["a"].post("project/project_features/delete",t)}var v=s("bc5b"),f=s("beeb"),b=s("f8c7"),k={name:"project-space-features",components:{versionDetail:f["default"],projectSelect:b["default"]},mixins:[l["a"]],data:function(){return{code:this.$route.params.code,project:{task_board_theme:"simple"},loading:!0,form:this.$form.createForm(this),projectVersionForm:this.$form.createForm(this),publishVersionForm:this.$form.createForm(this),projectFeaturesList:[],currentProjectFeatures:null,currentProjectVersion:null,versionTotal:1,versionList:{normal:[],published:[]},showPublished:!1,projectFeatures:{modalStatus:!1,confirmLoading:!1,modalTitle:"编辑版本库",info:null},projectVersion:{modalStatus:!1,confirmLoading:!1,modalTitle:"编辑版本",info:null},publishVersion:{modalStatus:!1,confirmLoading:!1,info:null,status:-1},versionDetail:{modalStatus:!1,code:""}}},created:function(){this.getProject(),this.init()},methods:{init:function(){this.getProjectFeaturesList()},getProject:function(){var t=this;this.loading=!0,Object(o["h"])(this.code).then((function(e){t.loading=!1,t.project=e.data}))},getProjectFeaturesList:function(){var t=this;d({projectCode:this.code}).then((function(e){t.projectFeaturesList=e.data,e.data.length&&!t.currentProjectFeature&&(t.currentProjectFeatures=e.data[0],t.getProjectVersionList())}))},getProjectVersionList:function(){var t=this;t.loading=!0,Object(v["g"])({projectFeaturesCode:this.currentProjectFeatures.code}).then((function(e){var s=0,i=[],a=[];e.data.forEach((function(t){s++,3==t.status?a.push(t):i.push(t)})),t.versionTotal=s,t.versionList.normal=i,t.versionList.published=a,t.loading=!1}))},createFeatures:function(){var t=this;t.projectFeatures.modalStatus=!0,t.projectFeatures.info=null,t.projectFeatures.modalTitle="创建版本库"},editFeatures:function(t){var e=this;e.projectFeatures.modalStatus=!0,e.projectFeatures.modalTitle="编辑版本库",e.projectFeatures.info=t,this.$nextTick((function(){e.form.setFieldsValue({name:t.name,description:t.description})}))},deleteFeatures:function(t){var e=this;this.$confirm({title:"删除版本库",content:"若将『".concat(t["name"],"』 删除，所有与版本库相关的信息将会被彻底删除，删除后不可恢复。"),okText:"删除",okType:"danger",cancelText:"再想想",onOk:function(){return h({featuresCode:t.code}).then((function(s){var i=Object(r["a"])(s);if(!i)return!1;e.currentProjectFeatures.code==t.code&&(e.currentProjectFeatures=null),e.init()})),Promise.resolve()}})},createVersion:function(){var t=this;t.projectVersion.modalStatus=!0,t.projectVersion.info=null,t.projectVersion.modalTitle="创建版本"},changeVersionStatus:function(t,e,s,i){var a=this,o=this;if(t.key==s.code)return!1;3==t.key?this.$confirm({title:"发布提示",content:"请确认当前版本发布内容已全部完成后再发布。",okText:"确认发布",okType:"primary",onOk:function(){return o.publishVersion.info=s,o.publishVersion.status=t.key,o.publishVersion.modalStatus=!0,o.$nextTick((function(){o.publishVersionForm.setFieldsValue({publishTime:moment()})})),Promise.resolve()}}):Object(v["b"])({versionCode:s.code,status:t.key}).then((function(t){a.getProjectVersionList()}))},showVersionDetail:function(t){this.versionDetail.modalStatus=!0,this.versionDetail.code=t},versionDetailClose:function(){this.versionDetail.modalStatus=!1,this.versionDetail.code="",this.getProjectVersionList()},handleSubmitPublishVersion:function(){var t=this,e=this;e.publishVersionForm.validateFields((function(s){if(!s){var i=e.publishVersionForm.getFieldsValue();i.publishTime=moment(i.publishTime).format("YYYY-MM-DD HH:mm"),Object(v["b"])({versionCode:t.publishVersion.info.code,status:t.publishVersion.status,publishTime:i.publishTime}).then((function(t){e.publishVersion.modalStatus=!1,e.getProjectVersionList()}))}}))},handleSubmit:function(){var t=this;t.form.validateFields((function(e){e||t.handleOk()}))},handleOk:function(){var t=this,e=this;e.projectFeatures.confirmLoading=!0;var s=e.form.getFieldsValue();s.projectCode=this.code,e.projectFeatures.info?(s.featuresCode=e.projectFeatures.info.code,m(s).then((function(s){e.projectFeatures.confirmLoading=!1,Object(r["a"])(s)&&(e.form.resetFields(),t.getProjectFeaturesList(),e.projectFeatures.modalStatus=!1)}))):p(s).then((function(t){e.projectFeatures.confirmLoading=!1,Object(r["a"])(t)&&(e.form.resetFields(),e.projectFeatures.modalStatus=!1,e.init())}))},handleSubmitProjectVersion:function(){var t=this;t.projectVersionForm.validateFields((function(e){e||t.handleOkProjectVersion()}))},handleOkProjectVersion:function(){var t=this;t.projectVersion.confirmLoading=!0;var e=t.projectVersionForm.getFieldsValue();e.featuresCode=this.currentProjectFeatures.code,e.startTime=moment(e.startTime).format("YYYY-MM-DD HH:mm"),e.planPublishTime=moment(e.planPublishTime).format("YYYY-MM-DD HH:mm"),Object(v["j"])(e).then((function(e){t.projectVersion.confirmLoading=!1,Object(r["a"])(e)&&(t.projectVersionForm.resetFields(),t.projectVersion.modalStatus=!1,t.getProjectVersionList())}))},changeProjectFeatures:function(t){this.currentProjectFeatures=this.projectFeaturesList.find((function(e){return e.code==t.key})),this.getProjectVersionList()},collectProject:function(){var t=this,e=this.project.collected?"cancel":"collect";Object(n["a"])(this.project.code,e).then((function(e){Object(r["a"])(e)&&(t.project.collected=!t.project.collected)}))},formatTime:function(t){return Object(c["c"])(t)}}},g=k,w=(s("47cb"),s("2877")),j=Object(w["a"])(g,i,a,!1,null,null,null);e["default"]=j.exports},e55b:function(t,e,s){"use strict";s.d(e,"a",(function(){return a}));var i=s("22b6");function a(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"collect";return i["a"].post("project/project_collect/collect",{type:e,projectCode:t})}},f8c7:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.currentProject?s("div",{attrs:{id:"project-select"}},[s("a-dropdown",{staticClass:"action-item",attrs:{trigger:["click"],placement:"bottomCenter"},model:{value:t.visibleMenu,callback:function(e){t.visibleMenu=e},expression:"visibleMenu"}},[s("a-tooltip",{attrs:{mouseEnterDelay:.3,title:t.currentProject.name}},[s("a",{staticClass:"project-select",staticStyle:{color:"#333"},on:{click:function(e){t.visibleMenu=!0}}},[s("span",[t._v(t._s(t.currentProject.name))]),s("span",{staticClass:"m-l-xs"},[s("a-icon",{attrs:{type:"down"}})],1)])]),s("div",{staticClass:"middle-menu member-menu project-select-menu",attrs:{slot:"overlay"},slot:"overlay"},[s("div",{staticClass:"search-content"},[s("a-input",{attrs:{size:"large",placeholder:"搜索"},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}},[s("a-icon",{attrs:{slot:"prefix",type:"search"},slot:"prefix"})],1)],1),s("div",{staticClass:"member-list"},[s("vue-scroll",[s("div",{staticClass:"list-group"},[s("a-list",{staticClass:"list-content",attrs:{itemLayout:"horizontal",dataSource:t.projectList,locale:{emptyText:t.keyword&&t.keyword.length>1?"没有找到该项目":""}},scopedSlots:t._u([{key:"renderItem",fn:function(e){return s("a-list-item",{staticClass:"member-list-item",nativeOn:{click:function(s){return t.changeProject(e.code)}}},[s("span",{attrs:{slot:"actions"},slot:"actions"},[s("a-icon",{directives:[{name:"show",rawName:"v-show",value:t.showCheck(e.code),expression:"showCheck(item.code)"}],attrs:{type:"check"}})],1),s("a-list-item-meta",[s("span",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.name))]),s("a-avatar",{attrs:{slot:"avatar",icon:"user",src:e.cover},slot:"avatar"})],1)],1)}}],null,!1,3141279394)})],1)])],1)])],1)],1):t._e()},a=[],o=(s("8e6e"),s("ac6a"),s("456d"),s("7f7f"),s("386d"),s("bd86")),n=s("2ef0"),r=s.n(n),c=s("5880"),l=s("24d2"),u=s("1b80");function d(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,i)}return s}function p(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?d(Object(s),!0).forEach((function(e){Object(o["a"])(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):d(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}var m={name:"ProjectSelect",props:{code:{type:[String],default:function(){return""}}},data:function(){return{visibleMenu:!1,keyword:"",loading:!1,currentProject:null,projectList:[],projectListCopy:[],projectTotal:0}},mixins:[u["a"]],computed:p({},Object(c["mapState"])({currentOrganization:function(t){return t.currentOrganization},organizationList:function(t){return t.organizationList}})),watch:{code:function(){this.init()},keyword:function(){this.search()}},created:function(){this.init()},methods:{init:function(){this.getProject(),this.getProjectList(!0)},getProject:function(){var t=this;Object(l["b"])(this.code).then((function(e){t.currentProject=e.data}))},getProjectList:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.loading=e,this.requestData.pageSize=50,this.requestData.archive=-1,Object(l["c"])(this.requestData).then((function(e){t.projectList=e.data.list,t.projectListCopy=e.data.list,t.projectTotal=e.data.total,t.loading=!1}))},changeProject:function(t){this.visibleMenu=!1,this.$router.push("/project/space/task/"+t)},showCheck:function(t){if(t==this.code)return!0},search:r.a.debounce((function(){var t=this;if(this.keyword=this.keyword.trim(),this.keyword||(this.projectList=JSON.parse(JSON.stringify(this.projectListCopy))),this.keyword.length<=1)return!1;this.projectList=this.projectList.filter((function(e){return-1!=e.name.indexOf(t.keyword)}))}),500),getPopup:function(){return document.getElementById("project-select")}}},h=m,v=(s("7934"),s("2877")),f=Object(v["a"])(h,i,a,!1,null,null,null);e["default"]=f.exports}}]);